# 環境チェック結果と修正提案

## 概要

現在の企業システム開発プラットフォームの環境状態をチェックし、ユニバーサルデザイン対応や共通コンポーネント使用ガイドラインとの整合性を検証しました。

## チェック結果

### ✅ 良好な点

#### 1. プロジェクト構造
- モノレポ構成が適切に設定されている
- workspaces設定でpackages管理が可能
- テンプレートと開発環境の分離が実現されている

#### 2. 実行権限・スクリプト
- 全ての.shファイルに実行権限が設定済み
- デプロイスクリプトが完備されている
- 環境構築スクリプトが用意されている

#### 3. 基本ファイル構成
- package.jsonが各層で適切に配置
- TypeScript設定が整備されている
- ESLintルールが設定済み

#### 4. ドキュメント整備
- 13個のドキュメントが体系的に整理
- 読み順ガイドで段階的学習が可能
- 日本語ファイル名で理解しやすい

### ❌ 重大な問題点

#### 1. **ユニバーサルデザイン違反（緊急）**

**問題箇所：`workspace/frontend/src/App.vue:23`**
```css
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
```
- **問題**: UDゴシック未使用
- **重要度**: 🔴 緊急
- **影響**: アクセシビリティ基準違反

#### 2. **Element Plus 直接使用（重大）**

**問題箇所：複数ファイル**
```vue
<!-- workspace/frontend/src/views/Dashboard.vue -->
<el-card>        <!-- 禁止されたコンポーネント -->
<el-button>      <!-- 禁止されたコンポーネント -->
<el-table>       <!-- 禁止されたコンポーネント -->
<el-progress>    <!-- 禁止されたコンポーネント -->
```

- **問題**: 開発ガイドライン09で禁止されたElement Plus直接使用
- **重要度**: 🔴 重大
- **影響**: 共通コンポーネント戦略の破綻

#### 3. **共通テーマライブラリ未適用**

**問題**:
- `@company/shared-theme`がプロジェクトで使用されていない
- フォントサイズ・カラーパレットが独自実装
- アクセシビリティ対応が未実装

#### 4. **package.json依存関係の不整合**

**フロントエンド (`workspace/frontend/package.json`)**
```json
"dependencies": {
  "element-plus": "^2.5.1"  // 直接使用は禁止
}
```

**不足している依存関係**:
```json
"@company/shared-components": "workspace:*",
"@company/shared-theme": "workspace:*"
```

### ⚠️ 改善が必要な点

#### 1. npm スクリプトの不整合
- `workspace/frontend/package.json`に`dev:frontend`スクリプトが存在しない
- `workspace/backend/package.json`に`dev:backend`スクリプトが存在しない
- ルートの`npm run dev`が動作しない可能性

#### 2. 型チェック設定
- `type-check`スクリプトが存在するが、実際のtsconfig.jsonとの整合性未確認

#### 3. 共通コンポーネントライブラリの未実装
- `packages/shared-components`が存在しない
- CommonButton, CommonTable等の実装が必要

## 修正提案

### 🚨 緊急修正事項（Priority 1）

#### 1. UDゴシックフォント適用

**修正箇所**: `workspace/frontend/src/App.vue`
```vue
<!-- 修正前 -->
<style>
html, body, #app {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}
</style>

<!-- 修正後 -->
<style>
@import '@company/shared-theme';

html, body, #app {
  font-family: var(--font-family-primary); /* UDゴシック優先 */
  font-size: var(--font-size-accessible-min); /* 18px以上 */
  line-height: var(--line-height-normal); /* 1.5 */
}
</style>
```

#### 2. 共通テーマライブラリの導入

**修正箇所**: `workspace/frontend/package.json`
```json
{
  "dependencies": {
    "@company/shared-theme": "workspace:*",
    "@company/shared-components": "workspace:*"
  }
}
```

**修正箇所**: `workspace/frontend/src/main.ts`
```typescript
import { createApp } from 'vue'
import { createPinia } from 'pinia'
// Element Plus直接インポートを削除
// import ElementPlus from 'element-plus'
// import 'element-plus/dist/index.css'

// 共通テーマを適用
import '@company/shared-theme'

import App from './App.vue'
import router from './router'

const app = createApp(App)
const pinia = createPinia()

app.use(pinia)
app.use(router)
// Element Plus直接使用を削除
// app.use(ElementPlus, { locale: 'ja' })

app.mount('#app')
```

### 🔧 重要修正事項（Priority 2）

#### 1. 共通コンポーネントライブラリの実装

**作成が必要なディレクトリ**:
```
packages/shared-components/
├── package.json
├── src/
│   ├── components/
│   │   ├── CommonButton/
│   │   ├── CommonCard/
│   │   ├── CommonTable/
│   │   └── index.ts
│   └── index.ts
└── dist/
```

#### 2. Element Plus 使用箇所の置換

**修正が必要なファイル**:
- `workspace/frontend/src/views/Dashboard.vue`
- `workspace/frontend/src/views/Users.vue`
- `workspace/frontend/src/views/Login.vue`
- `workspace/frontend/src/views/Layout.vue`

**修正例**:
```vue
<!-- 修正前 -->
<el-button type="primary" @click="handleClick">
  クリック
</el-button>

<!-- 修正後 -->
<CommonButton variant="primary" @on-click="handleClick">
  クリック
</CommonButton>
```

#### 3. npm スクリプトの修正

**修正箇所**: `workspace/frontend/package.json`
```json
{
  "scripts": {
    "dev": "vite --host 0.0.0.0 --port 3000",
    "dev:frontend": "vite --host 0.0.0.0 --port 3000", // 追加
    "build": "vue-tsc && vite build",
    "build:frontend": "vue-tsc && vite build", // 追加
    "test:frontend": "vitest", // 追加
    "test:coverage": "vitest --coverage" // 追加
  }
}
```

**修正箇所**: `workspace/backend/package.json`
```json
{
  "scripts": {
    "dev:backend": "tsx watch src/index.ts", // 追加
    "build:backend": "tsc", // 追加
    "test:backend": "jest", // 追加
    "type-check": "tsc --noEmit" // 追加
  }
}
```

### 🔄 改善提案事項（Priority 3）

#### 1. ESLint設定の強化

**修正箇所**: `workspace/frontend/.eslintrc.js`
```javascript
module.exports = {
  extends: [
    '../../.eslintrc.js' // ルートのESLint設定を継承
  ]
}
```

#### 2. アクセシビリティチェックの自動化

**追加スクリプト**: `package.json`
```json
{
  "scripts": {
    "accessibility-check": "node tools/accessibility-checker.js",
    "font-check": "node tools/font-checker.js"
  }
}
```

#### 3. pre-commit フックの設定

**作成ファイル**: `.husky/pre-commit`
```bash
#!/bin/sh
npm run component-check:strict
npm run accessibility-check
npm run lint
```

## 実装順序

### Phase 1: 緊急修正（1-2日）
1. UDゴシックフォント適用
2. 共通テーマライブラリ導入
3. Element Plus直接使用の除去

### Phase 2: 重要修正（3-5日）
1. 共通コンポーネントライブラリ実装
2. 全コンポーネントの置換
3. npm スクリプト修正

### Phase 3: 改善実装（1週間）
1. アクセシビリティチェック強化
2. CI/CD パイプライン改善
3. 品質ゲート設定

## 検証方法

### 修正完了チェックリスト

- [ ] UDゴシックフォントが全体に適用されている
- [ ] Element Plus直接使用が0件になっている
- [ ] `npm run component-check:strict`がPASSする
- [ ] `npm run dev`が正常に動作する
- [ ] フォントサイズが16px以上になっている
- [ ] コントラスト比が4.5:1以上になっている
- [ ] 共通コンポーネントライブラリが動作する

### 自動チェックコマンド

```bash
# 修正前チェック
npm run component-check:html  # 現在の違反状況を確認

# 修正後チェック
npm run component-check:strict  # 違反があると終了コード1
npm run lint                    # コード品質チェック
npm run type-check             # 型チェック
```

## まとめ

現在の環境は**基盤は良好だが、実装レベルで重要な問題**があります。

**優先対応が必要**:
1. ユニバーサルデザイン違反の修正
2. 開発ガイドライン違反の修正
3. 共通コンポーネント戦略の実装

これらの修正により、真に統一されたアクセシブルなプラットフォームが完成します。