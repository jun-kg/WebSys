# 共通コンポーネント設計書

## 📋 機能概要

### 目的
- Element Plus依存を減らし独自デザインシステム構築
- 再利用可能なUIコンポーネント群の提供
- 一貫したユーザー体験の実現
- 開発効率の向上とメンテナンス性確保

### アーキテクチャ
- **パッケージ**: `packages/shared-components/`
- **技術**: Vue 3 Composition API + TypeScript
- **ビルド**: Vite ライブラリモード
- **配布**: Workspace Protocol

## 🧩 コンポーネント一覧

### 実装済みコンポーネント（15個）

| コンポーネント | バリアント数 | 主な用途 | 実装状況 |
|---------------|-------------|----------|----------|
| CommonButton | 4 | ボタン操作 | ✅ 完了 |
| CommonCard | 4 | カード表示 | ✅ 完了 |
| CommonTable | 4 | データ表格 | ✅ 完了 |
| CommonTableColumn | 4 | テーブル列 | ✅ 完了 |
| CommonTag | 4 | ラベル表示 | ✅ 完了 |
| CommonRow | 2 | レイアウト | ✅ 完了 |
| CommonCol | 2 | レイアウト | ✅ 完了 |
| CommonStatistic | 4 | 統計表示 | ✅ 完了 |
| CommonProgress | 4 | 進捗表示 | ✅ 完了 |
| CommonForm | 4 | フォーム | ✅ 完了 |
| CommonFormItem | 4 | フォーム項目 | ✅ 完了 |
| CommonInput | 4 | 入力フィールド | ✅ 完了 |
| CommonSelect | 4 | 選択フィールド | ✅ 完了 |
| CommonOption | 4 | 選択項目 | ✅ 完了 |
| CommonSwitch | 4 | スイッチ | ✅ 完了 |

### 新規レスポンシブコンポーネント（2025-09-27追加）

| コンポーネント | 対応画面数 | 主な用途 | 実装状況 |
|---------------|-----------|----------|----------|
| **ResponsiveCrudPage** | 10画面 | CRUD画面の統一化 | 🔄 計画中 |
| **ResponsiveTable** | 12画面 | テーブルレスポンシブ | 🔄 計画中 |
| **ResponsiveDialog** | 10画面 | ダイアログレスポンシブ | 🔄 計画中 |
| **ResponsiveForm** | 15画面 | フォームレスポンシブ | 🔄 計画中 |
| **ResponsiveGrid** | 17画面 | グリッドレスポンシブ | 🔄 計画中 |

**削減効果**: 個別対応850行 → 共通化500行（41%削減）

## 🎨 デザインシステム

### バリアント設計原則
各コンポーネントは4つの基本バリアントを持つ：

1. **default**: 標準的な用途
2. **compact**: 省スペース表示
3. **enhanced**: 機能拡張版
4. **specialized**: 特殊用途版

### レスポンシブ対応
- **responsive prop**: レスポンシブ動作の有効化
- **touch-optimized prop**: タッチ操作最適化
- **自動ブレイクポイント**: デバイス検知による自動調整

```typescript
// 共通Props定義
interface ResponsiveProps {
  responsive?: boolean      // レスポンシブ有効化
  touchOptimized?: boolean  // タッチ最適化
}
```

## 🔧 主要コンポーネント仕様

### CommonButton
```typescript
interface CommonButtonProps {
  variant: 'default' | 'primary' | 'action' | 'ghost'
  size?: 'small' | 'medium' | 'large'
  responsive?: boolean
  touchOptimized?: boolean
  loading?: boolean
  disabled?: boolean
}
```

**バリアント詳細**:
- **default**: グレー背景、汎用ボタン
- **primary**: ブランドカラー、主要アクション
- **action**: アクション専用、アイコン付き
- **ghost**: 透明背景、軽量表示

### CommonForm
```typescript
interface CommonFormProps {
  variant: 'default' | 'compact' | 'card' | 'inline'
  model: Record<string, any>
  rules?: FormRules
  labelPosition?: 'top' | 'left' | 'right'
  responsive?: boolean
}
```

**レスポンシブ機能**:
- モバイル時自動縦積み
- ラベル位置自動調整
- タッチ最適化

### CommonInput
```typescript
interface CommonInputProps {
  variant: 'default' | 'search' | 'secure' | 'numeric'
  modelValue: string
  placeholder?: string
  clearable?: boolean
  showPassword?: boolean
  responsive?: boolean
  touchOptimized?: boolean
}
```

**バリアント特徴**:
- **search**: 検索用丸角スタイル
- **secure**: セキュア入力、強化フォーカス
- **numeric**: 数値入力、右寄せ表示

## 📱 レスポンシブ実装

### ブレイクポイント定義
```typescript
const breakpoints = {
  xs: 320,   // スマートフォン（縦）
  sm: 576,   // スマートフォン（横）
  md: 768,   // タブレット（縦）
  lg: 992,   // タブレット（横）・小型PC
  xl: 1200,  // デスクトップ
  xxl: 1920  // 大型ディスプレイ
}
```

### デバイス検知
```typescript
const { isMobile, isTablet, isDesktop } = useResponsive()

const computedStyle = computed(() => {
  if (props.responsive) {
    if (isMobile.value) return mobileStyles
    if (isTablet.value) return tabletStyles
  }
  return defaultStyles
})
```

## ♿ アクセシビリティ対応

### WCAG 2.1 AA準拠
- **最小サイズ**: タッチターゲット44px以上
- **コントラスト比**: 4.5:1以上確保
- **フォーカス管理**: キーボード操作対応
- **スクリーンリーダー**: aria-label適切設定

### フォント設定
```css
font-family:
  "BIZ UDPGothic",
  "BIZ UDGothic",
  sans-serif;
font-size: 16px;  /* 最小推奨サイズ */
line-height: 1.6; /* 読みやすい行間 */
```

## 🏗️ アーキテクチャ設計

### ディレクトリ構造
```
packages/shared-components/
├── src/
│   ├── components/           # コンポーネント本体
│   │   ├── CommonButton/
│   │   │   ├── index.vue    # メインコンポーネント
│   │   │   └── types.ts     # 型定義
│   │   └── ...
│   ├── composables/         # 共通ロジック
│   │   ├── useResponsive.ts # レスポンシブ制御
│   │   └── useTheme.ts      # テーマ制御
│   ├── styles/              # 共通スタイル
│   │   ├── variables.scss   # CSS変数
│   │   └── mixins.scss      # SCSSミックスイン
│   └── index.ts            # エクスポート管理
├── package.json
└── vite.config.ts
```

### エクスポート管理
```typescript
// packages/shared-components/src/index.ts
export { default as CommonButton } from './components/CommonButton/index.vue'
export { default as CommonCard } from './components/CommonCard/index.vue'
// ... 他15個のコンポーネント

export type {
  CommonButtonProps,
  CommonCardProps,
  // ... 型定義
} from './types'
```

## 🧪 テスト戦略

### 単体テスト
- **Vue Testing Library**: コンポーネントレンダリング
- **Vitest**: テストランナー
- **@vue/test-utils**: Vue専用ユーティリティ

### テストカバレッジ目標
- **Props**: 全バリアントの動作確認
- **Events**: イベント発火・受信
- **Slots**: スロット内容の表示
- **Responsive**: ブレイクポイント動作

### E2Eテスト
- **Playwright**: ブラウザ自動化
- **Visual Regression**: スクリーンショット比較
- **Accessibility**: アクセシビリティ検証

## 📦 パッケージ管理

### インストール
```bash
# メインプロジェクトで使用
npm install file:../../packages/shared-components
```

### 使用方法
```vue
<template>
  <CommonCard variant="default">
    <CommonButton
      variant="primary"
      responsive
      touch-optimized
      @on-click="handleClick"
    >
      クリック
    </CommonButton>
  </CommonCard>
</template>

<script setup lang="ts">
import { CommonCard, CommonButton } from '@company/shared-components'
</script>
```

## 🚀 実装状況と今後の計画

### Phase 1-4 完了実績
- **削減効果**: Element Plus使用量 180箇所 → 82箇所（54.4%削減）
- **統一性**: デザインシステム確立
- **品質**: アクセシビリティ・レスポンシブ対応完了

### 今後の拡張計画

#### Phase 5: ナビゲーション系（予定）
- CommonPagination
- CommonBreadcrumb
- CommonDropdown
- CommonMenu

#### Phase 6: レイアウト系（予定）
- CommonContainer
- CommonAside
- CommonHeader
- CommonMain

#### Phase 7: フィードバック系（予定）
- CommonDialog
- CommonMessage
- CommonNotification
- CommonLoading

### 最終目標
- **Element Plus依存**: 82箇所 → 10箇所以下
- **開発ガイドライン遵守率**: 95%以上
- **完全な独自デザインシステム**: 確立

## 📋 関連ドキュメント

- [レスポンシブ対応設計書](../05_レスポンシブ対応/)
- [アクセシビリティ設計書](../06_アクセシビリティ/)
- [システム基盤設計書](../99_システム基盤/)

---

**作成日**: 2025年1月20日
**最終更新**: 2025年1月20日
**作成者**: Claude
**レビュー者**: -