# レスポンシブ対応設計書

## 📋 機能概要

### 目的
- PC・タブレット・スマートフォンでの最適表示
- デバイス特性に応じたUI/UX最適化
- タッチ操作とマウス操作の両対応
- アクセシビリティ向上

### 対象範囲
- 全画面・全コンポーネント
- 共通コンポーネント群
- レイアウトシステム

## 📐 ブレイクポイント設計

### ブレイクポイント定義
| デバイス | 幅 | ターゲット |
|----------|----|---------  |
| xs | 320px~ | スマートフォン（縦） |
| sm | 576px~ | スマートフォン（横） |
| md | 768px~ | タブレット（縦） |
| lg | 992px~ | タブレット（横）・小型PC |
| xl | 1200px~ | デスクトップ |
| xxl | 1920px~ | 大型ディスプレイ |

### メディアクエリ戦略
```scss
// Mobile First アプローチ
@media (min-width: 576px) { /* sm以上 */ }
@media (min-width: 768px) { /* md以上 */ }
@media (min-width: 992px) { /* lg以上 */ }
@media (min-width: 1200px) { /* xl以上 */ }
@media (min-width: 1920px) { /* xxl以上 */ }
```

## 📱 デバイス別UI設計

### スマートフォン (xs-sm)
- **レイアウト**: 1カラム縦積み
- **フォントサイズ**: 16px以上（iOS zoom防止）
- **タッチターゲット**: 最小44px
- **ナビゲーション**: ハンバーガーメニュー
- **フォーム**: 縦積みレイアウト

### タブレット (md-lg)
- **レイアウト**: 2カラム + 一部縦積み
- **フォントサイズ**: 16px
- **タッチターゲット**: 44px推奨
- **ナビゲーション**: ドロワー + トップバー
- **フォーム**: 部分的横並び

### デスクトップ (xl-xxl)
- **レイアウト**: 3カラム横並び
- **フォントサイズ**: 16px
- **操作**: マウス・キーボード最適化
- **ナビゲーション**: サイドバー + ヘッダー
- **フォーム**: 横並びレイアウト

## 🎯 コンポーネント別対応

### 共通レスポンシブコンポーネント体系

#### ResponsiveCrudPage（最重要）
```vue
<template>
  <!-- CRUD画面の共通パターン（10画面対応） -->
  <ResponsiveCrudPage
    title="ユーザー管理"
    :columns="tableColumns"
    :data="tableData"
    :dialog-width="500"
    @add="handleAdd"
    @edit="handleEdit"
    @delete="handleDelete"
  >
    <template #search>
      <el-input v-model="search" placeholder="検索..." />
    </template>
    <template #dialog-content>
      <ResponsiveForm :model="form" :rules="rules">
        <!-- フォーム内容 -->
      </ResponsiveForm>
    </template>
  </ResponsiveCrudPage>
</template>
```

**対応画面**: Users, Companies, Departments, FeatureManagement, PermissionTemplate, AlertRules, NotificationSettings, Reports等

#### ResponsiveTable
```vue
<template>
  <!-- テーブルのレスポンシブ対応を一元化 -->
  <div class="responsive-table-container">
    <el-table
      :data="data"
      :style="{ minWidth: computedMinWidth }"
      v-bind="$attrs"
    >
      <el-table-column
        v-for="column in visibleColumns"
        :key="column.prop"
        v-bind="getColumnProps(column)"
      />
      <el-table-column
        label="操作"
        :width="actionWidth"
        :fixed="!isMobile && 'right'"
      >
        <template #default="{ row }">
          <slot name="actions" :row="row">
            <el-button size="small" @click="$emit('edit', row)">編集</el-button>
            <el-button size="small" type="danger" @click="$emit('delete', row)">削除</el-button>
          </slot>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>
```

**特徴**:
- 自動横スクロール対応
- モバイル時の操作列fixed解除
- 重要度による列の表示/非表示制御
- タッチ操作最適化

#### ResponsiveDialog
```vue
<template>
  <!-- ダイアログの幅を自動調整 -->
  <el-dialog
    v-model="modelValue"
    :title="title"
    :width="computedWidth"
    :fullscreen="isMobile && fullscreenOnMobile"
  >
    <slot></slot>
  </el-dialog>
</template>

<script setup lang="ts">
const computedWidth = computed(() => {
  if (isMobile.value) return '95%'
  if (isTablet.value) return '80%'
  return props.desktopWidth || '600px'
})
</script>
```

#### ResponsiveForm
```vue
<template>
  <!-- フォームレイアウトの自動調整 -->
  <el-form
    :model="model"
    :rules="rules"
    :label-position="computedLabelPosition"
    :label-width="computedLabelWidth"
  >
    <slot></slot>
  </el-form>
</template>

<script setup lang="ts">
const computedLabelPosition = computed(() => {
  if (isMobile.value) return 'top'
  return props.labelPosition || 'right'
})

const computedLabelWidth = computed(() => {
  if (isMobile.value) return 'auto'
  return props.labelWidth || '120px'
})
</script>
```

#### ResponsiveGrid
```vue
<template>
  <!-- グリッドレイアウトの簡略化 -->
  <el-row :gutter="computedGutter">
    <slot></slot>
  </el-row>
</template>

<!-- ResponsiveCol -->
<template>
  <el-col
    :xs="xs || mobile || 24"
    :sm="sm || tablet || mobile || 24"
    :md="md || tablet || desktop || 12"
    :lg="lg || desktop || 8"
    :xl="xl || desktop || 6"
  >
    <slot></slot>
  </el-col>
</template>
```

### グリッドシステム
```vue
<template>
  <!-- 新しいレスポンシブカラム -->
  <ResponsiveGrid :gutter="20">
    <ResponsiveCol :mobile="24" :tablet="12" :desktop="6">
      統計カード
    </ResponsiveCol>
  </ResponsiveGrid>
</template>
```

### フォームレスポンシブ
```typescript
// CommonForm のレスポンシブ制御
const computedLabelPosition = computed((): LabelPosition => {
  if (props.responsive) {
    if (isMobile.value) return 'top'        // モバイル: 縦積み
    if (isTablet.value) return 'top'        // タブレット: 縦積み
  }
  return props.labelPosition                // デスクトップ: 横並び
})
```

### ボタンレスポンシブ
```css
.common-button--responsive {
  /* モバイル: フル幅 */
  @media (max-width: 767px) {
    width: 100%;
    margin-bottom: 8px;
  }

  /* タブレット: 適度な余白 */
  @media (min-width: 768px) and (max-width: 991px) {
    min-width: 120px;
    margin-right: 8px;
  }
}
```

## 🖼️ レイアウト実装

### Dashboard レスポンシブ
```scss
// 統計サマリー
.stats-row {
  .el-col {
    @media (max-width: 767px) {
      span: 24; margin-bottom: 16px;
    }
    @media (min-width: 768px) and (max-width: 991px) {
      span: 12;
    }
    @media (min-width: 992px) {
      span: 6;
    }
  }
}

// メインコンテンツ
.content-row {
  @media (max-width: 767px) {
    .el-col:first-child { span: 24; margin-bottom: 20px; }
    .el-col:last-child { span: 24; }
  }
  @media (min-width: 768px) {
    .el-col:first-child { span: 16; }
    .el-col:last-child { span: 8; }
  }
}
```

### Users画面レスポンシブ
```scss
// 検索フォーム
.search-form {
  @media (max-width: 767px) {
    .el-form-item {
      display: block;
      margin-right: 0;
      margin-bottom: 16px;
    }
  }
}

// テーブル
.users-table {
  @media (max-width: 767px) {
    .el-table__body-wrapper {
      overflow-x: auto;
    }
    .el-table th,
    .el-table td {
      min-width: 100px;
    }
  }
}
```

## 📏 タッチ最適化

### タッチターゲット仕様
```css
.touch-optimized {
  min-height: 44px;
  min-width: 44px;

  /* 拡張タッチ領域 */
  &::before {
    content: '';
    position: absolute;
    top: -12px; left: -12px;
    right: -12px; bottom: -12px;
  }
}
```

### スワイプ・ジェスチャー対応
```typescript
// 将来実装予定
interface TouchGesture {
  swipeLeft: () => void    // 左スワイプ
  swipeRight: () => void   // 右スワイプ
  pinchZoom: (scale: number) => void  // ピンチズーム
}
```

## 🔧 Composable実装

### useResponsive
```typescript
import { ref, computed, onMounted, onUnmounted } from 'vue'

export const useResponsive = () => {
  const windowWidth = ref(window.innerWidth)

  const isMobile = computed(() => windowWidth.value < 768)
  const isTablet = computed(() =>
    windowWidth.value >= 768 && windowWidth.value < 992
  )
  const isDesktop = computed(() => windowWidth.value >= 992)

  const updateWidth = () => {
    windowWidth.value = window.innerWidth
  }

  onMounted(() => {
    window.addEventListener('resize', updateWidth)
  })

  onUnmounted(() => {
    window.removeEventListener('resize', updateWidth)
  })

  return {
    windowWidth: readonly(windowWidth),
    isMobile,
    isTablet,
    isDesktop
  }
}
```

### useBreakpoint
```typescript
export const useBreakpoint = () => {
  const { windowWidth } = useResponsive()

  const currentBreakpoint = computed(() => {
    if (windowWidth.value < 576) return 'xs'
    if (windowWidth.value < 768) return 'sm'
    if (windowWidth.value < 992) return 'md'
    if (windowWidth.value < 1200) return 'lg'
    if (windowWidth.value < 1920) return 'xl'
    return 'xxl'
  })

  return { currentBreakpoint }
}
```

## 🧪 テスト戦略

### レスポンシブテスト
```typescript
// Playwright E2Eテスト
test.describe('Responsive Layout', () => {
  const devices = [
    { name: 'iPhone 12', width: 390, height: 844 },
    { name: 'iPad', width: 768, height: 1024 },
    { name: 'Desktop', width: 1200, height: 800 }
  ]

  devices.forEach(device => {
    test(`Layout on ${device.name}`, async ({ page }) => {
      await page.setViewportSize({
        width: device.width,
        height: device.height
      })
      await page.goto('/dashboard')

      // レイアウト確認
      await expect(page.locator('.stats-row')).toBeVisible()

      // スクリーンショット比較
      await expect(page).toHaveScreenshot(`dashboard-${device.name}.png`)
    })
  })
})
```

### ビジュアル回帰テスト
- **ツール**: Playwright Screenshot Testing
- **対象**: 全主要画面 × 3デバイス
- **頻度**: CI/CD パイプライン毎

## 📊 パフォーマンス最適化

### 画像最適化
```typescript
// レスポンシブ画像
interface ResponsiveImageProps {
  src: string
  srcSet?: string      // 複数解像度対応
  sizes?: string       // サイズ指定
  loading?: 'lazy'     // 遅延読み込み
}
```

### CSSバンドル最適化
```scss
// 条件付きCSS読み込み
@media (max-width: 767px) {
  @import 'mobile-styles';
}

@media (min-width: 768px) {
  @import 'desktop-styles';
}
```

## 🚀 実装状況

### 完了済み（既存）
- ✅ ブレイクポイント定義
- ✅ 基本レスポンシブ対応（7画面）
- ✅ useResponsive Composable
- ✅ 基本レイアウトシステム

### 2025-09-27 新規実装計画
#### Phase 1: 共通コンポーネント開発（3日）
- 🔄 **ResponsiveCrudPage** コンポーネント
- 🔄 **ResponsiveTable** コンポーネント
- 🔄 **ResponsiveDialog** コンポーネント
- 🔄 **ResponsiveForm** コンポーネント
- 🔄 **ResponsiveGrid** コンポーネント

#### Phase 2: パイロット適用（2日）
- 🔄 Users.vue の ResponsiveCrudPage 移行
- 🔄 動作検証・調整

#### Phase 3: 全面展開（5日）
- 🔄 CRUD画面10個の一括移行
  - Companies.vue
  - Departments.vue
  - FeatureManagement.vue
  - PermissionTemplate.vue
  - AlertRules.vue
  - NotificationSettings.vue
  - Reports.vue
  - 他3画面
- 🔄 特殊画面の個別対応
- 🔄 統合テスト

### 実装効果の測定
- **コード削減**: 各画面54行→15行（70%削減）
- **作業時間削減**: 17時間→8時間（53%削減）
- **保守性向上**: 重複コード削減、一元管理

### 今後の改善
- ⚠️ コンテナクエリ対応
- ⚠️ より細かいブレイクポイント
- ⚠️ ダークモード対応
- ⚠️ プリファードリダクション対応

## 📋 関連ドキュメント

- [共通コンポーネント設計書](../04_共通コンポーネント/)
- [アクセシビリティ設計書](../06_アクセシビリティ/)
- [システム基盤設計書](../99_システム基盤/)

---

**作成日**: 2025年1月20日
**最終更新**: 2025年1月20日
**作成者**: Claude
**レビュー者**: -