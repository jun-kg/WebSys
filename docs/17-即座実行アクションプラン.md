# 即座実行アクションプラン

## 🚨 Priority 1: 今すぐ実行（30分以内）

### 1. 未コミットファイルの整理とコミット

#### 📁 対象ファイル選別
```bash
# 権限管理システム核心ファイル
backend/src/routes/permissions.ts    # 権限API完全実装
frontend/src/views/PermissionMatrix.vue  # 権限マトリクス表示

# 機能管理システム
backend/src/routes/features.ts       # 機能管理API
frontend/src/views/FeatureManagement.vue # 機能管理画面

# 組織管理システム
backend/src/routes/companies.ts      # 会社管理API
backend/src/routes/departments.ts    # 部署管理API
frontend/src/views/Companies.vue     # 会社管理画面
frontend/src/views/Departments.vue   # 部署管理画面
```

#### 🔧 実行コマンド
```bash
cd /home/typho/src/elementplus/websys/workspace

# フェーズ1: 権限管理システム
git add backend/src/routes/permissions.ts frontend/src/views/PermissionMatrix.vue
git commit -m "feat: 権限マトリクス表示とテンプレート管理機能完成

- 権限マトリクス動的表示実装
- 権限テンプレートCRUD完全実装
- 部署×機能権限可視化
- リアルタイム権限更新機能

🤖 Generated with [Claude Code](https://claude.ai/code)
Co-Authored-By: Claude <noreply@anthropic.com>"

# フェーズ2: 機能・組織管理システム
git add backend/src/routes/features.ts backend/src/routes/companies.ts backend/src/routes/departments.ts
git add frontend/src/views/FeatureManagement.vue frontend/src/views/Companies.vue frontend/src/views/Departments.vue
git commit -m "feat: 機能管理・組織管理システム完成

- 機能マスタ管理CRUD実装
- 会社・部署管理システム
- 階層構造対応部署管理
- 機能カテゴリ管理

🤖 Generated with [Claude Code](https://claude.ai/code)
Co-Authored-By: Claude <noreply@anthropic.com>"
```

### 2. BUG #003修正 - IPv6 Rate Limiting

#### 📍 修正箇所
**ファイル**: `backend/src/routes/auth.ts:14`

#### 🔧 修正内容
```typescript
// 修正前
import rateLimit from 'express-rate-limit';

const loginRateLimit = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5,
  keyGenerator: (req) => req.ip,  // ← 問題箇所
  message: { /* ... */ }
});

// 修正後
import rateLimit, { ipKeyGenerator } from 'express-rate-limit';

const loginRateLimit = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5,
  keyGenerator: ipKeyGenerator,  // ← 修正
  message: { /* ... */ }
});
```

#### 🧪 テスト確認
```bash
# 修正後、IPv6警告が消えることを確認
docker compose logs backend | grep -i "ipv6"
# 警告が出力されないことを確認
```

## ⚡ Priority 2: 今日中に実行（2-3時間）

### 3. ログ監視システム基本実装

#### 📝 実装ファイル構成
```
backend/src/routes/logs.ts           # 既存拡張
  ├── GET /api/logs/search           # ログ検索API拡張
  ├── GET /api/logs/statistics       # 統計API拡張
  └── GET /api/logs/realtime         # リアルタイム監視

frontend/src/views/LogDashboard.vue  # 新規作成
frontend/src/views/LogSearch.vue     # 新規作成
frontend/src/components/LogChart.vue # 新規作成
```

#### 🎯 実装優先順位
1. **ログ検索API拡張** (30分)
2. **LogDashboard.vue作成** (60分)
3. **リアルタイム表示機能** (60分)
4. **ログ統計チャート** (30分)

#### 📊 LogDashboard.vue 基本構造
```vue
<template>
  <div class="log-dashboard">
    <!-- 統計カード -->
    <el-row :gutter="20">
      <el-col :span="6">
        <el-card>
          <el-statistic title="今日のログ" :value="stats.todayCount" />
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card>
          <el-statistic title="エラー数" :value="stats.errorCount" />
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card>
          <el-statistic title="警告数" :value="stats.warnCount" />
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card>
          <el-statistic title="エラー率" :value="stats.errorRate" suffix="%" />
        </el-card>
      </el-col>
    </el-row>

    <!-- ログレベル別チャート -->
    <el-card class="chart-card">
      <template #header>ログレベル別統計</template>
      <LogChart :data="chartData" />
    </el-card>

    <!-- リアルタイムログ -->
    <el-card class="log-table-card">
      <template #header>リアルタイムログ</template>
      <el-table :data="realtimeLogs" v-loading="loading">
        <el-table-column prop="timestamp" label="時刻" width="180" />
        <el-table-column prop="level" label="レベル" width="100">
          <template #default="scope">
            <el-tag :type="getLogLevelType(scope.row.level)">
              {{ scope.row.level }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="message" label="メッセージ" />
        <el-table-column prop="source" label="ソース" width="120" />
      </el-table>
    </el-card>
  </div>
</template>
```

## 📋 今日の完了チェックリスト

### ✅ 完了確認項目
- [ ] **権限管理ファイルコミット**
  - [ ] permissions.ts コミット
  - [ ] PermissionMatrix.vue コミット
  - [ ] 権限テンプレートAPI動作確認

- [ ] **機能・組織管理ファイルコミット**
  - [ ] features.ts, companies.ts, departments.ts コミット
  - [ ] 対応するVueコンポーネントコミット
  - [ ] API動作確認

- [ ] **BUG #003修正**
  - [ ] auth.ts修正
  - [ ] IPv6警告消失確認
  - [ ] Rate Limiting正常動作確認

- [ ] **ログ監視基本機能**
  - [ ] LogDashboard.vue作成
  - [ ] 基本統計表示
  - [ ] リアルタイムログ表示

### 🧪 動作確認テスト
```bash
# 1. 権限管理システム
curl -X GET "http://localhost:8000/api/permissions/matrix?companyId=1" \
  -H "Authorization: Bearer $TOKEN"

# 2. 統計API
curl -X GET "http://localhost:8000/api/statistics/dashboard" \
  -H "Authorization: Bearer $TOKEN"

# 3. フロントエンドアクセス
curl -s http://localhost:3000 | head -1

# 4. ログAPI
curl -X GET "http://localhost:8000/api/logs/search?level=ERROR" \
  -H "Authorization: Bearer $TOKEN"
```

## 🎯 期待する成果

### 完了後の状況
- **システム完成度**: 90% → 95%
- **残りBUG**: 2件 → 1件
- **コミット済み機能**: 権限管理・組織管理完全実装
- **ログ監視**: 基本機能動作開始

### 次期対応準備
- 権限継承システム設計完了
- 高度ログ分析機能設計開始
- 運用マニュアル骨子作成

---

**実行開始時刻**: 記録用
**完了予定時刻**: 実行開始から3時間後
**次回アクション**: Phase 3の詳細計画策定