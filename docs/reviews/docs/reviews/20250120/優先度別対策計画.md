# 優先度別対策計画

## 実行計画概要

| フェーズ | 期間 | 工数 | 主要対象 | 完了条件 |
|---------|------|------|----------|----------|
| Phase 1 | 1-2日 | 3人日 | 緊急修正 | ガイドライン違反0件 |
| Phase 2 | 3-5日 | 7人日 | 重要修正 | 全コンポーネント置換完了 |
| Phase 3 | 1週間 | 5人日 | 改善実装 | 品質ゲート設置完了 |

## 🔴 Phase 1: 緊急修正（24-48時間）

### 目標
**開発ガイドライン違反とアクセシビリティ違反の即座解決**

### 1.1 UDゴシックフォント適用（2時間）

**対象ファイル**: `workspace/frontend/src/App.vue`

**現在のコード**:
```css
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
```

**修正後のコード**:
```css
/* UDゴシック優先のフォントスタック */
font-family:
  "UD Digi Kyokasho NP-R",    /* UDデジタル教科書体 */
  "UD Digi Kyokasho N-R",     /* UDデジタル教科書体 */
  "BIZ UDPGothic",            /* BIZ UDPゴシック */
  "BIZ UDGothic",             /* BIZ UDゴシック */
  "Hiragino Kaku Gothic ProN", /* ヒラギノ角ゴ ProN */
  "Noto Sans CJK JP",         /* Noto Sans CJK JP */
  "Meiryo",                   /* メイリオ */
  sans-serif;
```

**作業手順**:
1. `workspace/frontend/src/App.vue`を開く
2. スタイル部分のfont-familyを修正
3. ブラウザで確認（フォント変更の確認）

**検証方法**:
```bash
# フォント確認用スクリプト実行
npm run font-check
```

### 1.2 共通コンポーネントライブラリの最小実装（6時間）

**作業内容**: 最も使用頻度の高いコンポーネントを最小実装

#### 1.2.1 ディレクトリ構造作成

```bash
mkdir -p packages/shared-components/src/components
mkdir -p packages/shared-components/src/composables
mkdir -p packages/shared-components/dist
```

#### 1.2.2 CommonButton実装

**ファイル**: `packages/shared-components/src/components/CommonButton/index.vue`

```vue
<template>
  <el-button
    :type="elementVariant"
    :size="size"
    :loading="loading"
    :disabled="disabled"
    :class="buttonClasses"
    v-bind="$attrs"
    @click="handleClick"
  >
    <slot />
  </el-button>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { ElButton } from 'element-plus'
import { useResponsive } from '../../composables/useResponsive'

interface Props {
  variant?: 'primary' | 'secondary' | 'success' | 'warning' | 'danger'
  size?: 'small' | 'medium' | 'large'
  loading?: boolean
  disabled?: boolean
  responsive?: boolean
  touchOptimized?: boolean
  fullWidthMobile?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  variant: 'primary',
  size: 'medium',
  loading: false,
  disabled: false,
  responsive: false,
  touchOptimized: true,
  fullWidthMobile: false
})

const emit = defineEmits<{
  'on-click': [event: MouseEvent]
}>()

const { isMobile } = useResponsive()

const elementVariant = computed(() => {
  const variantMap = {
    primary: 'primary',
    secondary: 'default',
    success: 'success',
    warning: 'warning',
    danger: 'danger'
  }
  return variantMap[props.variant]
})

const buttonClasses = computed(() => [
  'common-button',
  {
    'common-button--responsive': props.responsive,
    'common-button--touch-optimized': props.touchOptimized,
    'common-button--full-width-mobile': props.fullWidthMobile && isMobile.value
  }
])

const handleClick = (event: MouseEvent) => {
  emit('on-click', event)
}
</script>

<style scoped>
.common-button {
  font-family: inherit; /* UDゴシック継承 */
}

.common-button--touch-optimized {
  min-height: 44px;
  min-width: 44px;
}

.common-button--full-width-mobile {
  width: 100%;
}

@media (max-width: 768px) {
  .common-button--responsive {
    font-size: 16px; /* モバイルで読みやすいサイズ */
    padding: 12px 16px;
  }
}
</style>
```

#### 1.2.3 useResponsive composable実装

**ファイル**: `packages/shared-components/src/composables/useResponsive.ts`

```typescript
import { computed, ref } from 'vue'
import { useWindowSize } from '@vueuse/core'

export function useResponsive() {
  const { width, height } = useWindowSize()

  const isMobile = computed(() => width.value < 768)
  const isTablet = computed(() => width.value >= 768 && width.value < 992)
  const isDesktop = computed(() => width.value >= 992)

  const currentBreakpoint = computed(() => {
    if (width.value < 576) return 'xs'
    if (width.value < 768) return 'sm'
    if (width.value < 992) return 'md'
    if (width.value < 1200) return 'lg'
    if (width.value < 1920) return 'xl'
    return 'xxl'
  })

  return {
    width,
    height,
    isMobile,
    isTablet,
    isDesktop,
    currentBreakpoint
  }
}
```

#### 1.2.4 package.json作成

**ファイル**: `packages/shared-components/package.json`

```json
{
  "name": "@company/shared-components",
  "version": "1.0.0",
  "main": "dist/index.js",
  "module": "dist/index.esm.js",
  "types": "dist/index.d.ts",
  "files": ["dist"],
  "scripts": {
    "build": "vite build",
    "dev": "vite build --watch"
  },
  "dependencies": {
    "vue": "^3.4.15",
    "element-plus": "^2.5.1",
    "@vueuse/core": "^10.7.1"
  },
  "devDependencies": {
    "vite": "^5.0.11",
    "typescript": "^5.3.3"
  }
}
```

### 1.3 Dashboard.vueのサンプル修正（2時間）

**目的**: 修正方法の確立とサンプル提示

**対象**: `workspace/frontend/src/views/Dashboard.vue`の一部修正

**修正前**:
```vue
<el-button type="primary" :icon="Plus" @click="handleNewUser">
  新規ユーザー
</el-button>
```

**修正後**:
```vue
<CommonButton variant="primary" @on-click="handleNewUser">
  <template #prefix>
    <Plus />
  </template>
  新規ユーザー
</CommonButton>
```

**作業手順**:
1. CommonButtonインポート追加
2. 1つのel-buttonをCommonButtonに置換
3. 動作確認
4. 他の開発者向けの修正例として文書化

### Phase 1 完了条件

- [ ] UDゴシックフォントが適用されている
- [ ] CommonButtonが実装され動作する
- [ ] Dashboard.vueで1つ以上のコンポーネントが置換済み
- [ ] ブラウザで正常に表示される
- [ ] 修正方法が文書化されている

## 🟡 Phase 2: 重要修正（1週間）

### 目標
**全Element Plusコンポーネントの共通コンポーネント置換**

### 2.1 残り共通コンポーネント実装（16時間）

#### 優先実装リスト
1. **CommonCard** (4時間)
2. **CommonTable** (8時間)
3. **CommonTag** (2時間)
4. **CommonRow/Col** (2時間)

#### CommonCard実装例

```vue
<template>
  <el-card
    :shadow="shadow"
    :class="cardClasses"
    v-bind="$attrs"
  >
    <template #header v-if="$slots.header || title">
      <slot name="header">
        <div class="common-card__header">
          <h3 class="common-card__title">{{ title }}</h3>
        </div>
      </slot>
    </template>

    <div class="common-card__body">
      <slot />
    </div>

    <template #footer v-if="$slots.footer">
      <div class="common-card__footer">
        <slot name="footer" />
      </div>
    </template>
  </el-card>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { ElCard } from 'element-plus'
import { useResponsive } from '../../composables/useResponsive'

interface Props {
  title?: string
  shadow?: 'always' | 'hover' | 'never'
  bodyPadding?: string
  headerPadding?: string
}

const props = withDefaults(defineProps<Props>(), {
  shadow: 'hover'
})

const { isMobile } = useResponsive()

const cardClasses = computed(() => [
  'common-card',
  {
    'common-card--mobile': isMobile.value
  }
])
</script>

<style scoped>
.common-card {
  font-family: inherit;
}

.common-card__title {
  font-size: 18px;
  font-weight: 600;
  margin: 0;
}

@media (max-width: 768px) {
  .common-card--mobile {
    margin: 8px;
  }

  .common-card__title {
    font-size: 16px;
  }
}
</style>
```

### 2.2 ファイル別置換計画（24時間）

#### 2.2.1 Dashboard.vue完全置換（6時間）
- el-row → CommonRow
- el-col → CommonCol
- el-card → CommonCard
- el-button → CommonButton
- el-table → CommonTable
- el-tag → CommonTag

#### 2.2.2 Users.vue置換（6時間）
- テーブル系コンポーネント中心

#### 2.2.3 Login.vue置換（6時間）
- フォーム系コンポーネント中心

#### 2.2.4 Layout.vue置換（6時間）
- レイアウト系コンポーネント中心

### 2.3 依存関係整理（4時間）

#### frontend package.json修正

**修正前**:
```json
{
  "dependencies": {
    "element-plus": "^2.5.1",
    "@element-plus/icons-vue": "^2.3.1"
  }
}
```

**修正後**:
```json
{
  "dependencies": {
    "@company/shared-components": "workspace:*",
    "@company/shared-theme": "workspace:*",
    "@element-plus/icons-vue": "^2.3.1"
  }
}
```

### Phase 2 完了条件

- [ ] 全共通コンポーネントが実装済み
- [ ] 5つの.vueファイルでElement Plus直接使用が0件
- [ ] package.json依存関係が整理済み
- [ ] 全機能が正常動作する
- [ ] レスポンシブ表示が適切に動作する

## 🟢 Phase 3: 改善実装（1週間）

### 目標
**品質ゲート設置と継続的な品質確保**

### 3.1 自動チェック機能実装（8時間）

#### ESLintルール追加

**ファイル**: `.eslintrc.js`

```javascript
module.exports = {
  rules: {
    // Element Plus直接使用を禁止
    'no-restricted-imports': [
      'error',
      {
        'paths': [
          {
            'name': 'element-plus',
            'importNames': [
              'ElButton', 'ElCard', 'ElTable', 'ElTag',
              'ElRow', 'ElCol', 'ElForm', 'ElInput'
            ],
            'message': '@company/shared-componentsを使用してください'
          }
        ]
      }
    ]
  }
}
```

#### カスタムESLintルール

**ファイル**: `tools/eslint-rules/require-common-components.js`

```javascript
module.exports = {
  meta: {
    type: 'problem',
    docs: {
      description: '共通コンポーネントの使用を強制',
    },
  },
  create(context) {
    return {
      JSXElement(node) {
        const elementName = node.openingElement.name.name
        if (elementName && elementName.startsWith('el-')) {
          context.report({
            node,
            message: `${elementName}の代わりに対応する共通コンポーネントを使用してください`
          })
        }
      }
    }
  }
}
```

### 3.2 共通テーマライブラリ適用（4時間）

#### main.tsで共通テーマ適用

**ファイル**: `workspace/frontend/src/main.ts`

```typescript
import { createApp } from 'vue'
import { createPinia } from 'pinia'

// 共通テーマ適用
import '@company/shared-theme'
// 共通コンポーネント
import SharedComponents from '@company/shared-components'

import App from './App.vue'
import router from './router'

const app = createApp(App)
const pinia = createPinia()

app.use(pinia)
app.use(router)
app.use(SharedComponents)

app.mount('#app')
```

### 3.3 CI/CD強化（8時間）

#### pre-commitフック

**ファイル**: `.husky/pre-commit`

```bash
#!/bin/sh
# フォントチェック
npm run font-check

# コンポーネント使用チェック
npm run component-check:strict

# 型チェック
npm run type-check

# リント
npm run lint

# アクセシビリティチェック
npm run accessibility-check
```

#### GitHub Actions追加

**ファイル**: `.github/workflows/quality-gate.yml`

```yaml
name: Quality Gate

on: [push, pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Component usage check
        run: npm run component-check:strict

      - name: Font check
        run: npm run font-check

      - name: Accessibility check
        run: npm run accessibility-check

      - name: Build check
        run: npm run build
```

### Phase 3 完了条件

- [ ] ESLintでElement Plus直接使用がエラーになる
- [ ] pre-commitフックが動作する
- [ ] CI/CDで品質チェックが実行される
- [ ] 共通テーマが適用されている
- [ ] 全自動チェックがPASSする

## 実行体制

### 担当者配置

| 役割 | 担当者 | 責任範囲 |
|------|--------|----------|
| プロジェクトリーダー | A氏 | 全体進捗管理 |
| フロントエンド担当 | B氏 | Vue.js関連修正 |
| 共通ライブラリ担当 | C氏 | 共通コンポーネント実装 |
| 品質管理担当 | D氏 | チェック機能実装 |

### 進捗管理

#### 日次チェックポイント
- 修正完了ファイル数
- 残りのElement Plus使用箇所数
- ビルドエラー件数
- テスト実行結果

#### 週次レビュー
- 品質メトリクス確認
- 次週計画調整
- 課題・リスク洗い出し

## リスク管理

### 高リスク
1. **共通コンポーネント実装の遅延**
   - 対策: 最小実装から段階的拡張
   - 回避策: Element Plusラッパーから開始

2. **既存機能への影響**
   - 対策: 段階的置換とテスト実施
   - 回避策: 並行開発による影響最小化

### 中リスク
1. **開発者への影響**
   - 対策: 明確な移行手順書作成
   - 回避策: サンプル実装提供

## 成功指標

### 定量指標
- Element Plus直接使用: 0件
- ビルドエラー: 0件
- ESLintエラー: 0件
- テストカバレッジ: 80%以上

### 定性指標
- 開発者の理解度向上
- コードレビュー効率化
- 保守性向上
- アクセシビリティ基準達成

## まとめ

この3段階の対策により、**理想的な企業システム開発プラットフォーム**が実現します。

**重要なポイント**:
1. 段階的実行によるリスク最小化
2. 品質ゲート設置による再発防止
3. 開発者への明確な移行手順提供

**期待される効果**:
- 開発ガイドライン100%遵守
- ユニバーサルデザイン基準達成
- 統一されたユーザー体験提供
- 継続的な品質確保