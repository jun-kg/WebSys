# レスポンシブコンポーネント詳細設計書

## 📋 概要

**作成日**: 2025-09-27
**対象**: 新規レスポンシブコンポーネント5個
**目的**: 17画面のレスポンシブ対応を共通化により効率化

---

## 🎯 コンポーネント仕様

### 1. ResponsiveCrudPage

#### 目的
CRUD画面の共通パターンを1つのコンポーネントで実現（10画面対応）

#### Props Interface
```typescript
interface ResponsiveCrudPageProps {
  // 基本情報
  title: string
  subtitle?: string

  // テーブル関連
  columns: TableColumn[]
  data: any[]
  loading?: boolean

  // ページネーション
  total?: number
  currentPage?: number
  pageSize?: number
  pageSizes?: number[]
  showPagination?: boolean

  // ダイアログ関連
  dialogVisible?: boolean
  dialogTitle?: string
  dialogWidth?: number | string

  // レスポンシブ設定
  tableMinWidth?: string
  hideColumnsOnMobile?: string[]

  // カスタマイズ
  showSearch?: boolean
  showActions?: boolean
  actionWidth?: number
}

interface TableColumn {
  prop: string
  label: string
  width?: number
  minWidth?: number
  important?: boolean  // モバイル時の表示優先度
  sortable?: boolean
  formatter?: (row: any) => string
}
```

#### Events
```typescript
interface ResponsiveCrudPageEmits {
  'add': () => void
  'edit': (row: any) => void
  'delete': (row: any) => void
  'search': (query: string) => void
  'page-change': (page: number) => void
  'size-change': (size: number) => void
  'selection-change': (selection: any[]) => void
}
```

#### Template Slots
```vue
<template>
  <ResponsiveCrudPage>
    <!-- カスタム検索フォーム -->
    <template #search>
      <el-form :inline="true">
        <el-form-item>
          <el-input placeholder="検索..." />
        </el-form-item>
      </el-form>
    </template>

    <!-- カスタムアクションボタン -->
    <template #header-actions>
      <el-button>エクスポート</el-button>
    </template>

    <!-- カスタム列内容 -->
    <template #column-status="{ row }">
      <el-tag :type="getStatusType(row.status)">
        {{ row.status }}
      </el-tag>
    </template>

    <!-- カスタムアクション -->
    <template #row-actions="{ row }">
      <el-button @click="view(row)">詳細</el-button>
    </template>

    <!-- ダイアログ内容 -->
    <template #dialog-content>
      <ResponsiveForm>
        <!-- フォーム内容 -->
      </ResponsiveForm>
    </template>
  </ResponsiveCrudPage>
</template>
```

#### 実装例
```vue
<!-- Users.vue の新しい実装 -->
<template>
  <ResponsiveCrudPage
    title="ユーザー管理"
    :columns="userColumns"
    :data="users"
    :total="total"
    :loading="loading"
    @add="addUser"
    @edit="editUser"
    @delete="deleteUser"
  >
    <template #search>
      <el-input
        v-model="searchQuery"
        placeholder="ユーザー名、メール、氏名、社員番号で検索..."
        clearable
        @keyup.enter="handleSearch"
      />
    </template>
  </ResponsiveCrudPage>
</template>

<script setup lang="ts">
const userColumns = ref([
  { prop: 'username', label: 'ユーザー名', minWidth: 150, important: true },
  { prop: 'name', label: '氏名', minWidth: 150, important: true },
  { prop: 'email', label: 'メール', minWidth: 200 },
  { prop: 'company.name', label: '会社', minWidth: 150 },
  { prop: 'role', label: '権限', minWidth: 120, important: true }
])
</script>
```

---

### 2. ResponsiveTable

#### 目的
テーブルのレスポンシブ対応を自動化

#### Props Interface
```typescript
interface ResponsiveTableProps {
  data: any[]
  columns?: TableColumn[]
  showSelection?: boolean
  showActions?: boolean
  actionWidth?: number
  minWidth?: string
  hideColumnsOnMobile?: string[]
  stickyHeader?: boolean
}
```

#### 実装詳細
```vue
<template>
  <div class="responsive-table-container">
    <el-table
      :data="data"
      :style="{ minWidth: computedMinWidth }"
      v-bind="$attrs"
    >
      <!-- 選択列 -->
      <el-table-column
        v-if="showSelection"
        type="selection"
        :width="isMobile ? 40 : 55"
      />

      <!-- データ列 -->
      <el-table-column
        v-for="column in visibleColumns"
        :key="column.prop"
        v-bind="getColumnProps(column)"
      >
        <template #default="{ row }" v-if="$slots[`column-${column.prop}`]">
          <slot :name="`column-${column.prop}`" :row="row" />
        </template>
      </el-table-column>

      <!-- アクション列 -->
      <el-table-column
        v-if="showActions"
        label="操作"
        :width="computedActionWidth"
        :fixed="!isMobile && 'right'"
      >
        <template #default="{ row }">
          <slot name="actions" :row="row">
            <el-button size="small" @click="$emit('edit', row)">
              編集
            </el-button>
            <el-button
              size="small"
              type="danger"
              @click="$emit('delete', row)"
            >
              削除
            </el-button>
          </slot>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useResponsive } from '@/composables/useResponsive'

const { isMobile, isTablet } = useResponsive()

// モバイル時は重要な列のみ表示
const visibleColumns = computed(() => {
  if (!props.columns) return []

  if (isMobile.value) {
    return props.columns.filter(col =>
      col.important !== false &&
      !props.hideColumnsOnMobile?.includes(col.prop)
    )
  }
  return props.columns
})

const computedMinWidth = computed(() => {
  if (isMobile.value) return '100%'
  return props.minWidth || '800px'
})

const computedActionWidth = computed(() => {
  if (isMobile.value) return 80
  return props.actionWidth || 150
})

const getColumnProps = (column: TableColumn) => {
  const props = { ...column }

  // 固定幅を最小幅に変換
  if (props.width && !props.minWidth) {
    props.minWidth = props.width
    delete props.width
  }

  // モバイル時の幅調整
  if (isMobile.value && props.minWidth) {
    props.minWidth = Math.min(props.minWidth as number, 120)
  }

  return props
}
</script>

<style scoped>
.responsive-table-container {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

@media (max-width: 768px) {
  .responsive-table-container {
    margin: 0 -16px;
    padding: 0 16px;
  }

  :deep(.el-table) {
    font-size: 12px;
  }

  :deep(.el-table .cell) {
    padding: 0 4px;
  }

  :deep(.el-button) {
    padding: 4px 8px;
    font-size: 12px;
  }
}
</style>
```

---

### 3. ResponsiveDialog

#### 目的
ダイアログの幅をデバイスに応じて自動調整

#### Props Interface
```typescript
interface ResponsiveDialogProps {
  modelValue: boolean
  title?: string
  desktopWidth?: string | number
  tabletWidth?: string | number
  mobileWidth?: string | number
  fullscreenOnMobile?: boolean
  responsive?: boolean
}
```

#### 実装詳細
```vue
<template>
  <el-dialog
    :model-value="modelValue"
    :title="title"
    :width="computedWidth"
    :fullscreen="computedFullscreen"
    v-bind="$attrs"
    @update:model-value="$emit('update:modelValue', $event)"
  >
    <slot></slot>

    <template #footer v-if="$slots.footer">
      <div class="dialog-footer" :class="{ 'mobile-footer': isMobile }">
        <slot name="footer"></slot>
      </div>
    </template>
  </el-dialog>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useResponsive } from '@/composables/useResponsive'

const { isMobile, isTablet } = useResponsive()

const computedWidth = computed(() => {
  if (!props.responsive) return props.desktopWidth || '600px'

  if (isMobile.value) {
    return props.mobileWidth || '95%'
  }
  if (isTablet.value) {
    return props.tabletWidth || '80%'
  }
  return props.desktopWidth || '600px'
})

const computedFullscreen = computed(() => {
  return isMobile.value && props.fullscreenOnMobile
})
</script>

<style scoped>
.mobile-footer {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.mobile-footer :deep(.el-button) {
  width: 100%;
}

@media (min-width: 769px) {
  .mobile-footer {
    flex-direction: row;
    justify-content: flex-end;
  }

  .mobile-footer :deep(.el-button) {
    width: auto;
  }
}
</style>
```

---

### 4. ResponsiveForm

#### 目的
フォームレイアウトをデバイスに応じて自動調整

#### Props Interface
```typescript
interface ResponsiveFormProps {
  model: Record<string, any>
  rules?: Record<string, any>
  labelPosition?: 'left' | 'right' | 'top'
  labelWidth?: string | number
  responsive?: boolean
  mobileStack?: boolean
}
```

#### 実装詳細
```vue
<template>
  <el-form
    :model="model"
    :rules="rules"
    :label-position="computedLabelPosition"
    :label-width="computedLabelWidth"
    v-bind="$attrs"
  >
    <slot></slot>
  </el-form>
</template>

<script setup lang="ts">
const computedLabelPosition = computed(() => {
  if (!props.responsive) return props.labelPosition || 'right'

  if (isMobile.value || (isTablet.value && props.mobileStack)) {
    return 'top'
  }
  return props.labelPosition || 'right'
})

const computedLabelWidth = computed(() => {
  if (!props.responsive) return props.labelWidth || '120px'

  if (isMobile.value) return 'auto'
  return props.labelWidth || '120px'
})
</script>
```

---

### 5. ResponsiveGrid & ResponsiveCol

#### 目的
グリッドレイアウトの簡略化

#### Props Interface
```typescript
interface ResponsiveGridProps {
  gutter?: number
  justify?: string
  align?: string
}

interface ResponsiveColProps {
  // 簡略プロパティ
  mobile?: number    // xs, sm
  tablet?: number    // md
  desktop?: number   // lg, xl

  // 従来プロパティ（互換性）
  xs?: number
  sm?: number
  md?: number
  lg?: number
  xl?: number
  span?: number
}
```

#### 実装詳細
```vue
<!-- ResponsiveGrid -->
<template>
  <el-row
    :gutter="computedGutter"
    :justify="justify"
    :align="align"
  >
    <slot></slot>
  </el-row>
</template>

<!-- ResponsiveCol -->
<template>
  <el-col v-bind="computedColProps">
    <slot></slot>
  </el-col>
</template>

<script setup lang="ts">
const computedColProps = computed(() => {
  return {
    xs: props.xs || props.mobile || 24,
    sm: props.sm || props.mobile || 24,
    md: props.md || props.tablet || props.desktop || 12,
    lg: props.lg || props.desktop || 8,
    xl: props.xl || props.desktop || 6,
    span: props.span
  }
})
</script>
```

---

## 🔧 使用方法

### 移行前後の比較

#### Before: Users.vue (54行)
```vue
<template>
  <div class="users-page">
    <el-card>
      <template #header>
        <div class="card-header">
          <span>ユーザー管理</span>
          <el-button type="primary" @click="handleAdd">
            <el-icon><Plus /></el-icon>
            新規追加
          </el-button>
        </div>
      </template>

      <el-form :inline="true" :model="searchForm">
        <!-- 検索フォーム -->
      </el-form>

      <el-table :data="tableData">
        <!-- テーブル定義 -->
      </el-table>

      <el-pagination>
        <!-- ページネーション -->
      </el-pagination>
    </el-card>

    <el-dialog>
      <!-- ダイアログ内容 -->
    </el-dialog>
  </div>
</template>
```

#### After: Users.vue (15行)
```vue
<template>
  <ResponsiveCrudPage
    title="ユーザー管理"
    :columns="userColumns"
    :data="users"
    :total="total"
    @add="addUser"
    @edit="editUser"
  >
    <template #search>
      <el-input v-model="search" placeholder="検索..." />
    </template>
  </ResponsiveCrudPage>
</template>
```

**削減効果: 54行 → 15行（72%削減）**

---

## 📊 実装効果

### 定量効果
| 項目 | Before | After | 削減率 |
|------|--------|-------|--------|
| 実装行数 | 850行 | 500行 | 41% |
| 各画面行数 | 54行 | 15行 | 72% |
| 開発時間 | 17時間 | 8時間 | 53% |
| メンテナンス工数 | 17倍 | 1倍 | 94% |

### 定性効果
- **一貫性**: 全画面で統一されたレスポンシブ動作
- **保守性**: バグ修正・機能追加が一箇所で完結
- **品質**: 十分にテストされたコンポーネントを再利用

---

## 🚀 実装計画

### Phase 1: コンポーネント開発（3日）
1. **Day 1**: ResponsiveTable + ResponsiveDialog
2. **Day 2**: ResponsiveCrudPage（コア機能）
3. **Day 3**: ResponsiveForm + ResponsiveGrid

### Phase 2: パイロット適用（2日）
4. **Day 4**: Users.vue をResponsiveCrudPageに移行
5. **Day 5**: 動作確認・調整・テスト

### Phase 3: 全面展開（5日）
6. **Day 6-9**: 残り9画面の一括移行
7. **Day 10**: 統合テスト・品質確認

---

## 📋 関連ドキュメント

- [レスポンシブ対応設計書](../05_レスポンシブ対応/)
- [共通コンポーネント設計書](./共通コンポーネント設計書.md)
- [レスポンシブデザイン改善提案書](../../37-レスポンシブデザイン改善提案書.md)

---

**作成日**: 2025-09-27
**作成者**: システム開発チーム
**レビュー**: 要実施