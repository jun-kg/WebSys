# 一括ユーザー操作機能設計書

**作成日**: 2025-10-06
**対象システム**: WebSys 社内システム基盤
**対象機能**: 一括ユーザー操作（CSV インポート/エクスポート）
**関連タスク**: T021

---

## 📋 目次

1. [概要](#概要)
2. [要件定義](#要件定義)
3. [CSV仕様](#csv仕様)
4. [データベース設計](#データベース設計)
5. [API設計](#api設計)
6. [UI/UX設計](#uiux設計)
7. [バリデーション設計](#バリデーション設計)
8. [エラーハンドリング](#エラーハンドリング)
9. [セキュリティ対策](#セキュリティ対策)
10. [実装計画](#実装計画)

---

## 概要

### 目的

大量のユーザーデータを効率的に管理するため、CSV形式での一括インポート・エクスポート機能を提供します。

### 対象範囲

- **CSV エクスポート**: ユーザーデータの一括出力
- **CSV インポート**: ユーザーデータの一括登録・更新
- **バリデーション**: データ整合性チェック
- **エラーハンドリング**: 詳細なエラーレポート
- **履歴管理**: インポート履歴の記録

### 期待効果

- ✅ 大量ユーザー登録の効率化（手動登録比80%時間削減）
- ✅ データ移行作業の簡略化
- ✅ 人為的ミスの削減（自動バリデーション）
- ✅ 監査対応の向上（履歴記録）

---

## 要件定義

### 機能要件

#### FR-001: CSV エクスポート

| 項目 | 内容 |
|------|------|
| **機能** | ユーザーデータをCSV形式で出力 |
| **対象データ** | ユーザー、会社、部署、権限情報 |
| **フィルタ** | 検索条件適用可能 |
| **文字コード** | UTF-8 BOM付き（Excel対応） |
| **権限** | ADMIN, MANAGER（自部署のみ） |

#### FR-002: CSV インポート

| 項目 | 内容 |
|------|------|
| **機能** | CSVファイルからユーザーデータを一括登録・更新 |
| **モード** | 新規登録モード、更新モード、新規+更新モード |
| **最大件数** | 1回あたり1,000件 |
| **バリデーション** | 事前検証（実行前にエラー一覧表示） |
| **権限** | ADMIN, MANAGER（自部署のみ） |

#### FR-003: 履歴管理

| 項目 | 内容 |
|------|------|
| **機能** | インポート履歴の記録・閲覧 |
| **記録内容** | 実行日時、実行者、処理件数、成功/失敗件数 |
| **保存期間** | 1年間 |
| **権限** | ADMIN, MANAGER（自部署のみ） |

### 非機能要件

#### NFR-001: パフォーマンス

| 項目 | 目標値 |
|------|--------|
| **エクスポート速度** | 1,000件/秒 |
| **インポート速度** | 100件/秒（バリデーション込み） |
| **最大ファイルサイズ** | 10MB |
| **同時実行数** | 3件まで |

#### NFR-002: セキュリティ

| 項目 | 対策 |
|------|------|
| **権限チェック** | RBAC による厳格な権限制御 |
| **データ暗号化** | アップロード時のHTTPS通信 |
| **監査ログ** | 全操作を audit_logs に記録 |
| **データ検証** | SQLインジェクション対策 |

---

## CSV仕様

### エクスポートCSV形式

#### ヘッダー定義

```csv
ID,ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,会社名,部署ID,部署名,有効/無効,作成日時,更新日時
```

#### データ例

```csv
ID,ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,会社名,部署ID,部署名,有効/無効,作成日時,更新日時
1,admin,admin@example.com,管理者,EMP001,ADMIN,1,サンプル株式会社,1,情報システム部,有効,2025-01-01 00:00:00,2025-01-01 00:00:00
2,tanaka,tanaka@example.com,田中太郎,EMP002,USER,1,サンプル株式会社,2,営業部,有効,2025-01-02 10:30:00,2025-01-02 10:30:00
```

#### カラム仕様

| カラム名 | 必須 | 型 | 最大長 | 備考 |
|---------|------|-----|-------|------|
| ID | ⬜ | 数値 | - | 更新時のみ必須 |
| ユーザー名 | ✅ | 文字列 | 50 | 英数字のみ |
| メールアドレス | ✅ | 文字列 | 255 | メール形式 |
| 氏名 | ✅ | 文字列 | 100 | - |
| 社員番号 | ⬜ | 文字列 | 50 | - |
| 役職 | ✅ | 列挙型 | - | ADMIN/MANAGER/USER/GUEST |
| 会社ID | ✅ | 数値 | - | 存在チェック |
| 会社名 | ⬜ | 文字列 | 255 | 参照情報（インポート時は無視） |
| 部署ID | ⬜ | 数値 | - | 存在チェック |
| 部署名 | ⬜ | 文字列 | 255 | 参照情報（インポート時は無視） |
| 有効/無効 | ✅ | 文字列 | - | 有効 or 無効 |
| 作成日時 | ⬜ | 日時 | - | 参照情報（インポート時は無視） |
| 更新日時 | ⬜ | 日時 | - | 参照情報（インポート時は無視） |

### インポートCSV形式（簡易版）

#### 新規登録用ヘッダー

```csv
ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,部署ID,有効/無効,パスワード
```

#### 更新用ヘッダー

```csv
ID,ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,部署ID,有効/無効
```

#### データ例（新規登録）

```csv
ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,部署ID,有効/無効,パスワード
yamada,yamada@example.com,山田花子,EMP003,USER,1,2,有効,Password123!
suzuki,suzuki@example.com,鈴木一郎,EMP004,MANAGER,1,3,有効,Password456!
```

---

## データベース設計

### 新規テーブル: bulk_import_logs

```sql
CREATE TABLE bulk_import_logs (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id),
  import_type VARCHAR(20) NOT NULL,  -- 'USER', 'COMPANY', 'DEPARTMENT'
  operation_mode VARCHAR(20) NOT NULL, -- 'CREATE', 'UPDATE', 'UPSERT'
  file_name VARCHAR(255) NOT NULL,
  file_size INTEGER NOT NULL,
  total_rows INTEGER NOT NULL,
  success_count INTEGER NOT NULL DEFAULT 0,
  failure_count INTEGER NOT NULL DEFAULT 0,
  error_details JSONB,
  status VARCHAR(20) NOT NULL DEFAULT 'PENDING', -- 'PENDING', 'PROCESSING', 'COMPLETED', 'FAILED'
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_bulk_import_logs_user_id ON bulk_import_logs(user_id);
CREATE INDEX idx_bulk_import_logs_status ON bulk_import_logs(status);
CREATE INDEX idx_bulk_import_logs_created_at ON bulk_import_logs(created_at);
```

### エラー詳細形式（error_details JSONB）

```json
{
  "errors": [
    {
      "row": 2,
      "field": "メールアドレス",
      "value": "invalid-email",
      "error": "メール形式が不正です"
    },
    {
      "row": 5,
      "field": "会社ID",
      "value": "999",
      "error": "存在しない会社IDです"
    }
  ],
  "warnings": [
    {
      "row": 3,
      "field": "社員番号",
      "message": "社員番号が重複しています"
    }
  ]
}
```

---

## API設計

### 1. CSV エクスポート

**エンドポイント**: `GET /api/users/export`

**権限**: `USER_EXPORT` (ADMIN, MANAGER)

**クエリパラメータ**:
```typescript
interface ExportParams {
  search?: string           // 検索文字列
  companyId?: number        // 会社IDフィルタ
  departmentId?: number     // 部署IDフィルタ
  role?: string             // 役職フィルタ
  isActive?: boolean        // 有効/無効フィルタ
  format?: 'full' | 'simple' // フル版 or シンプル版
}
```

**レスポンス**:
```
Content-Type: text/csv; charset=utf-8
Content-Disposition: attachment; filename="users_export_20251006.csv"

<CSV データ>
```

**実装例**:
```typescript
// backend/src/custom/routes/bulk-operations.ts
router.get('/users/export',
  authenticate,
  authorize(['USER_EXPORT']),
  async (req, res) => {
    const params = req.query as ExportParams
    const userId = (req as any).user.id

    // 権限スコープチェック
    const scope = await rolePermissionService.getUserPermissionScope(userId)

    const csvData = await bulkOperationService.exportUsers({
      ...params,
      scope,
      userId
    })

    res.setHeader('Content-Type', 'text/csv; charset=utf-8')
    res.setHeader('Content-Disposition', `attachment; filename="users_export_${Date.now()}.csv"`)
    res.send('\ufeff' + csvData) // BOM付き
  }
)
```

### 2. CSV インポート（検証）

**エンドポイント**: `POST /api/users/import/validate`

**権限**: `USER_IMPORT` (ADMIN, MANAGER)

**リクエストボディ**:
```typescript
Content-Type: multipart/form-data

{
  file: <File>,                // CSVファイル
  mode: 'CREATE' | 'UPDATE' | 'UPSERT'  // 実行モード
}
```

**レスポンス**:
```json
{
  "success": true,
  "data": {
    "totalRows": 100,
    "validRows": 95,
    "invalidRows": 5,
    "errors": [
      {
        "row": 2,
        "field": "メールアドレス",
        "value": "invalid-email",
        "error": "メール形式が不正です"
      }
    ],
    "warnings": [
      {
        "row": 3,
        "field": "社員番号",
        "message": "社員番号が重複しています"
      }
    ],
    "preview": [
      {
        "row": 1,
        "username": "yamada",
        "email": "yamada@example.com",
        "name": "山田花子"
      }
    ]
  }
}
```

### 3. CSV インポート（実行）

**エンドポイント**: `POST /api/users/import/execute`

**権限**: `USER_IMPORT` (ADMIN, MANAGER)

**リクエストボディ**:
```typescript
Content-Type: multipart/form-data

{
  file: <File>,
  mode: 'CREATE' | 'UPDATE' | 'UPSERT'
}
```

**レスポンス**:
```json
{
  "success": true,
  "data": {
    "importLogId": 123,
    "totalRows": 100,
    "successCount": 95,
    "failureCount": 5,
    "errors": [],
    "message": "95件のユーザーを正常にインポートしました"
  }
}
```

### 4. インポート履歴取得

**エンドポイント**: `GET /api/users/import/history`

**権限**: `USER_IMPORT` (ADMIN, MANAGER)

**クエリパラメータ**:
```typescript
interface HistoryParams {
  page?: number
  pageSize?: number
  importType?: string  // 'USER', 'COMPANY', 'DEPARTMENT'
  status?: string      // 'COMPLETED', 'FAILED'
}
```

**レスポンス**:
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 123,
        "fileName": "users_import.csv",
        "totalRows": 100,
        "successCount": 95,
        "failureCount": 5,
        "status": "COMPLETED",
        "createdAt": "2025-10-06T10:30:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 10
  }
}
```

---

## UI/UX設計

### 画面構成

#### 1. ユーザー管理画面への追加

**ボタン配置**:
```vue
<PageHeader
  title="ユーザー管理"
  :breadcrumbs="breadcrumbs"
>
  <template #actions>
    <el-button @click="handleExport">
      <el-icon><Download /></el-icon>
      CSVエクスポート
    </el-button>
    <el-button @click="handleImport">
      <el-icon><Upload /></el-icon>
      CSVインポート
    </el-button>
    <el-button type="primary" @click="handleAdd">
      <el-icon><Plus /></el-icon>
      新規追加
    </el-button>
  </template>
</PageHeader>
```

#### 2. CSVエクスポートダイアログ

```vue
<el-dialog title="CSVエクスポート" v-model="exportDialogVisible" width="500px">
  <el-form :model="exportForm" label-width="120px">
    <el-form-item label="エクスポート形式">
      <el-radio-group v-model="exportForm.format">
        <el-radio label="full">フル版（全情報）</el-radio>
        <el-radio label="simple">シンプル版（基本情報のみ）</el-radio>
      </el-radio-group>
    </el-form-item>

    <el-form-item label="検索条件適用">
      <el-switch v-model="exportForm.applyFilter" />
      <div class="hint">現在の検索条件を適用してエクスポート</div>
    </el-form-item>

    <el-form-item label="対象件数">
      <el-tag>{{ exportForm.estimatedCount }}件</el-tag>
    </el-form-item>
  </el-form>

  <template #footer>
    <el-button @click="exportDialogVisible = false">キャンセル</el-button>
    <el-button type="primary" @click="handleExecuteExport">
      <el-icon><Download /></el-icon>
      エクスポート実行
    </el-button>
  </template>
</el-dialog>
```

#### 3. CSVインポートダイアログ

```vue
<el-dialog title="CSVインポート" v-model="importDialogVisible" width="700px">
  <!-- ステップ1: ファイル選択 -->
  <el-steps v-if="importStep < 3" :active="importStep" finish-status="success">
    <el-step title="ファイル選択" />
    <el-step title="検証" />
    <el-step title="実行" />
  </el-steps>

  <!-- ステップ1: ファイル選択 -->
  <div v-if="importStep === 0" class="import-step">
    <el-form :model="importForm" label-width="120px">
      <el-form-item label="インポートモード">
        <el-radio-group v-model="importForm.mode">
          <el-radio label="CREATE">新規登録のみ</el-radio>
          <el-radio label="UPDATE">更新のみ</el-radio>
          <el-radio label="UPSERT">新規+更新</el-radio>
        </el-radio-group>
      </el-form-item>

      <el-form-item label="CSVファイル">
        <el-upload
          ref="uploadRef"
          :auto-upload="false"
          :limit="1"
          accept=".csv"
          @change="handleFileChange"
        >
          <el-button>ファイルを選択</el-button>
        </el-upload>
        <div class="hint">
          CSVテンプレートをダウンロード:
          <el-link type="primary" @click="downloadTemplate('create')">新規登録用</el-link>
          <el-link type="primary" @click="downloadTemplate('update')">更新用</el-link>
        </div>
      </el-form-item>
    </el-form>
  </div>

  <!-- ステップ2: 検証結果 -->
  <div v-if="importStep === 1" class="import-step">
    <el-alert
      v-if="validationResult.invalidRows === 0"
      type="success"
      :closable="false"
      show-icon
    >
      <template #title>
        検証成功: {{ validationResult.validRows }}件のデータが正常です
      </template>
    </el-alert>

    <el-alert
      v-else
      type="warning"
      :closable="false"
      show-icon
    >
      <template #title>
        エラー検出: {{ validationResult.invalidRows }}件のエラーがあります
      </template>
    </el-alert>

    <div class="validation-stats">
      <el-descriptions :column="3" border>
        <el-descriptions-item label="総行数">{{ validationResult.totalRows }}</el-descriptions-item>
        <el-descriptions-item label="有効">{{ validationResult.validRows }}</el-descriptions-item>
        <el-descriptions-item label="エラー">{{ validationResult.invalidRows }}</el-descriptions-item>
      </el-descriptions>
    </div>

    <!-- エラー一覧 -->
    <div v-if="validationResult.errors.length > 0" class="error-list">
      <h4>エラー詳細</h4>
      <el-table :data="validationResult.errors" max-height="300">
        <el-table-column prop="row" label="行" width="80" />
        <el-table-column prop="field" label="項目" width="150" />
        <el-table-column prop="value" label="値" width="200" />
        <el-table-column prop="error" label="エラー内容" />
      </el-table>
    </div>

    <!-- プレビュー -->
    <div class="preview-list">
      <h4>データプレビュー（最初の5件）</h4>
      <el-table :data="validationResult.preview.slice(0, 5)" max-height="200">
        <el-table-column prop="username" label="ユーザー名" width="150" />
        <el-table-column prop="email" label="メールアドレス" width="200" />
        <el-table-column prop="name" label="氏名" width="150" />
        <el-table-column prop="role" label="役職" width="100" />
      </el-table>
    </div>
  </div>

  <!-- ステップ3: 実行結果 -->
  <div v-if="importStep === 2" class="import-step">
    <el-result
      :icon="importResult.successCount > 0 ? 'success' : 'error'"
      :title="importResult.message"
    >
      <template #extra>
        <el-descriptions :column="2" border>
          <el-descriptions-item label="成功">{{ importResult.successCount }}件</el-descriptions-item>
          <el-descriptions-item label="失敗">{{ importResult.failureCount }}件</el-descriptions-item>
        </el-descriptions>
      </template>
    </el-result>
  </div>

  <template #footer>
    <el-button v-if="importStep > 0 && importStep < 2" @click="importStep--">戻る</el-button>
    <el-button @click="handleCloseImport">{{ importStep === 2 ? '閉じる' : 'キャンセル' }}</el-button>
    <el-button
      v-if="importStep === 0"
      type="primary"
      :disabled="!importForm.file"
      @click="handleValidate"
    >
      次へ（検証）
    </el-button>
    <el-button
      v-if="importStep === 1"
      type="primary"
      :disabled="validationResult.invalidRows > 0"
      @click="handleExecuteImport"
    >
      インポート実行
    </el-button>
  </template>
</el-dialog>
```

---

## バリデーション設計

### バリデーションルール

#### 1. ユーザー名

```typescript
const validateUsername = (username: string): ValidationResult => {
  if (!username) {
    return { valid: false, error: 'ユーザー名は必須です' }
  }
  if (!/^[a-zA-Z0-9_-]+$/.test(username)) {
    return { valid: false, error: 'ユーザー名は英数字・アンダースコア・ハイフンのみ使用できます' }
  }
  if (username.length < 3 || username.length > 50) {
    return { valid: false, error: 'ユーザー名は3〜50文字で入力してください' }
  }
  return { valid: true }
}
```

#### 2. メールアドレス

```typescript
const validateEmail = (email: string): ValidationResult => {
  if (!email) {
    return { valid: false, error: 'メールアドレスは必須です' }
  }
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
  if (!emailRegex.test(email)) {
    return { valid: false, error: 'メールアドレスの形式が不正です' }
  }
  if (email.length > 255) {
    return { valid: false, error: 'メールアドレスは255文字以内で入力してください' }
  }
  return { valid: true }
}
```

#### 3. 役職

```typescript
const validateRole = (role: string): ValidationResult => {
  const validRoles = ['ADMIN', 'MANAGER', 'USER', 'GUEST']
  if (!validRoles.includes(role)) {
    return { valid: false, error: `役職はADMIN, MANAGER, USER, GUESTのいずれかを指定してください` }
  }
  return { valid: true }
}
```

#### 4. 会社ID・部署ID（存在チェック）

```typescript
const validateCompanyId = async (companyId: number): Promise<ValidationResult> => {
  const company = await prisma.companies.findUnique({
    where: { id: companyId }
  })
  if (!company) {
    return { valid: false, error: `会社ID ${companyId} は存在しません` }
  }
  return { valid: true }
}
```

#### 5. 重複チェック

```typescript
const validateDuplicate = async (username: string, email: string, existingId?: number): Promise<ValidationResult> => {
  // ユーザー名重複チェック
  const existingUsername = await prisma.users.findFirst({
    where: {
      username,
      ...(existingId && { id: { not: existingId } })
    }
  })
  if (existingUsername) {
    return { valid: false, error: `ユーザー名「${username}」は既に使用されています` }
  }

  // メールアドレス重複チェック
  const existingEmail = await prisma.users.findFirst({
    where: {
      email,
      ...(existingId && { id: { not: existingId } })
    }
  })
  if (existingEmail) {
    return { valid: false, error: `メールアドレス「${email}」は既に使用されています` }
  }

  return { valid: true }
}
```

---

## エラーハンドリング

### エラー分類

| エラーレベル | 説明 | 処理 |
|-------------|------|------|
| **ERROR** | 致命的エラー（必須項目欠如、形式不正） | インポート中止 |
| **WARNING** | 警告（重複、推奨値外） | インポート続行可能 |
| **INFO** | 情報（スキップされた行） | 記録のみ |

### エラーメッセージ設計

```typescript
const ERROR_MESSAGES = {
  REQUIRED_FIELD: (field: string) => `${field}は必須です`,
  INVALID_FORMAT: (field: string) => `${field}の形式が不正です`,
  NOT_FOUND: (type: string, id: number) => `${type} ID ${id} は存在しません`,
  DUPLICATE: (field: string, value: string) => `${field}「${value}」は既に使用されています`,
  LENGTH_EXCEEDED: (field: string, max: number) => `${field}は${max}文字以内で入力してください`,
  INVALID_VALUE: (field: string, validValues: string[]) => `${field}は${validValues.join(', ')}のいずれかを指定してください`
}
```

---

## セキュリティ対策

### 1. ファイルアップロード検証

```typescript
// ファイルサイズ制限: 10MB
const MAX_FILE_SIZE = 10 * 1024 * 1024

// 拡張子チェック
const ALLOWED_EXTENSIONS = ['.csv']

// MIMEタイプチェック
const ALLOWED_MIME_TYPES = ['text/csv', 'application/vnd.ms-excel']
```

### 2. SQLインジェクション対策

```typescript
// Prismaの型安全なクエリを使用
// 動的SQLは使用しない
const user = await prisma.users.create({
  data: {
    username: sanitize(csvRow.username),
    email: sanitize(csvRow.email),
    // ...
  }
})
```

### 3. 権限スコープ制御

```typescript
// MANAGERは自部署のユーザーのみインポート可能
if (scope.role === 'MANAGER') {
  if (!csvRow.departmentId || !scope.departmentIds.includes(csvRow.departmentId)) {
    throw new Error('自部署以外のユーザーはインポートできません')
  }
}
```

### 4. 監査ログ記録

```typescript
// インポート実行時に監査ログ記録
await prisma.audit_logs.create({
  data: {
    userId,
    action: 'USER_BULK_IMPORT',
    targetType: 'USER',
    details: {
      fileName,
      totalRows,
      successCount,
      failureCount
    }
  }
})
```

---

## 実装計画

### Phase 1: バックエンド実装（2週間）

#### Week 1: CSV エクスポート
- [ ] BulkOperationService 実装（CSVエクスポート）
- [ ] `/api/users/export` エンドポイント実装
- [ ] 権限スコープチェック実装
- [ ] UTF-8 BOM対応

#### Week 2: CSV インポート
- [ ] BulkOperationService 実装（CSVインポート）
- [ ] `/api/users/import/validate` エンドポイント実装
- [ ] `/api/users/import/execute` エンドポイント実装
- [ ] `/api/users/import/history` エンドポイント実装
- [ ] bulk_import_logs テーブル作成
- [ ] バリデーションロジック実装

### Phase 2: フロントエンド実装（1週間）

#### Week 3: UI実装
- [ ] CSVエクスポートダイアログ実装
- [ ] CSVインポートダイアログ実装（3ステップ）
- [ ] インポート履歴画面実装
- [ ] エラー表示・警告表示実装

### Phase 3: テスト・最適化（1週間）

#### Week 4: テスト
- [ ] 単体テスト（バリデーション）
- [ ] 結合テスト（エクスポート・インポート）
- [ ] パフォーマンステスト（1,000件）
- [ ] セキュリティテスト

**総所要期間**: 4週間

---

## 成功指標

### パフォーマンス指標

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| **エクスポート速度** | 1,000件/秒 | パフォーマンステスト |
| **インポート速度** | 100件/秒 | パフォーマンステスト |
| **最大処理件数** | 1,000件/回 | 負荷テスト |
| **エラー検出率** | 100% | バリデーションテスト |

### ユーザビリティ指標

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| **操作完了率** | 95%以上 | ユーザーテスト |
| **エラー理解度** | 90%以上 | ユーザーアンケート |
| **作業時間削減率** | 80%以上 | 手動登録との比較 |

---

## 付録

### A. CSVテンプレートダウンロード実装

```typescript
// frontend/src/api/bulk-operations.ts
export const downloadTemplate = (type: 'create' | 'update') => {
  const headers = type === 'create'
    ? 'ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,部署ID,有効/無効,パスワード'
    : 'ID,ユーザー名,メールアドレス,氏名,社員番号,役職,会社ID,部署ID,有効/無効'

  const sample = type === 'create'
    ? 'yamada,yamada@example.com,山田花子,EMP003,USER,1,2,有効,Password123!'
    : '1,admin,admin@example.com,管理者,EMP001,ADMIN,1,1,有効'

  const csv = `${headers}\n${sample}`
  const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' })
  const link = document.createElement('a')
  link.href = URL.createObjectURL(blob)
  link.download = `user_import_template_${type}_${Date.now()}.csv`
  link.click()
}
```

### B. 関連ドキュメント

- [改善実装タスク管理表](../../legacy/numbered-docs/51-改善実装タスク管理表.md)
- [ユーザー管理機能設計書](../02_ユーザー管理機能/ユーザー管理機能設計書.md)
- [RBAC権限設計書](../02_権限管理/役職権限体系設計書.md)

---

**作成日**: 2025-10-06
**バージョン**: 1.0
**承認状態**: 設計中
