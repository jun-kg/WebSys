# 申請・承認ワークフロー機能設計書

**文書番号**: FD-006
**作成日**: 2025-09-27
**バージョン**: 1.0
**作成者**: システム開発チーム
**承認者**: プロジェクトマネージャー

---

## 📋 目次

1. [概要](#1-概要)
2. [機能要件](#2-機能要件)
3. [非機能要件](#3-非機能要件)
4. [ユーザーインターフェース](#4-ユーザーインターフェース)
5. [ビジネスルール](#5-ビジネスルール)
6. [外部インターフェース](#6-外部インターフェース)
7. [セキュリティ要件](#7-セキュリティ要件)
8. [運用要件](#8-運用要件)

---

## 1. 概要

### 1.1 目的
企業内の各種申請（有給申請、出張申請、購買申請、その他業務申請）から承認までのワークフローを完全デジタル化し、業務効率化とガバナンス強化を実現する。

### 1.2 適用範囲
- 全社員の申請業務
- 管理職の承認業務
- 人事・総務部門の管理業務
- 経営陣の最終承認業務

### 1.3 前提条件
- 既存の認証システム（JWT）との連携
- 既存の権限管理システム（RBAC）との統合
- 既存のユーザー・組織マスタとの連携

### 1.4 制約条件
- 既存システムのテーブル構造を変更しない
- 既存のUIデザインシステムに準拠
- レスポンシブデザイン対応必須

---

## 2. 機能要件

### 2.1 申請機能

#### 2.1.1 申請書作成機能
**機能ID**: WF-001
**優先度**: High

**機能概要**:
ユーザーが各種申請書を作成する機能

**詳細要件**:
- 申請種別の選択
- 動的フォームによる申請内容入力
- ファイル添付機能（複数ファイル対応）
- 下書き保存機能
- 申請前プレビュー機能
- 承認ルートの事前確認

**入力項目**:
| 項目名 | 必須 | 形式 | 制約 | 備考 |
|--------|------|------|------|------|
| 申請種別 | ○ | 選択 | 登録済み種別 | 動的フォーム定義の基準 |
| 申請タイトル | ○ | 文字列 | 1-200文字 | 申請内容の要約 |
| 申請内容 | ○ | 動的 | 種別による | JSON形式で保存 |
| 緊急度 | △ | 選択 | LOW/NORMAL/HIGH/URGENT | デフォルト：NORMAL |
| 希望完了日 | △ | 日付 | 申請日以降 | 業務計画用 |
| 添付ファイル | △ | ファイル | 最大10MB | PDF,Word,Excel,画像 |

**処理フロー**:
```
1. 申請種別選択
2. 動的フォーム表示
3. 申請内容入力
4. ファイル添付（任意）
5. 承認ルート確認
6. 下書き保存 OR 申請提出
7. 申請番号発行
8. 承認者通知送信
```

#### 2.1.2 申請履歴管理機能
**機能ID**: WF-002
**優先度**: High

**機能概要**:
自分が提出した申請の履歴を確認・管理する機能

**詳細要件**:
- 申請一覧表示（ページング対応）
- ステータス別フィルタ（下書き、申請中、承認済み、却下、キャンセル）
- 申請種別別フィルタ
- 期間指定検索
- 申請詳細表示
- 進捗状況の可視化
- 申請のキャンセル（承認前のみ）

**表示項目**:
| 項目名 | 説明 | 表示形式 |
|--------|------|----------|
| 申請番号 | 自動発行される一意番号 | WF-YYYYMMDD-XXXX |
| 申請種別 | 申請の分類 | アイコン + テキスト |
| 申請タイトル | 申請内容の要約 | テキスト |
| ステータス | 現在の処理状況 | カラーバッジ |
| 現在承認者 | 承認待ちの担当者 | ユーザー名 + アバター |
| 申請日 | 申請を提出した日 | YYYY-MM-DD |
| 完了予定日 | 承認完了の予想日 | YYYY-MM-DD |

#### 2.1.3 申請複製機能
**機能ID**: WF-003
**優先度**: Low

**機能概要**:
過去の申請内容を複製して新規申請を作成する機能

**詳細要件**:
- 過去申請の選択
- 申請内容のコピー
- 添付ファイルの再利用
- 複製後の編集機能

### 2.2 承認機能

#### 2.2.1 承認処理機能
**機能ID**: WF-010
**優先度**: High

**機能概要**:
承認者が申請に対して承認・却下・差戻しを行う機能

**詳細要件**:
- 承認待ち一覧表示
- 申請詳細確認
- 承認・却下・差戻しアクション
- 承認コメント入力（必須）
- 添付ファイル追加（任意）
- 次承認者の指定（差戻し時）

**アクション種別**:
| アクション | 説明 | 次の処理 |
|------------|------|----------|
| 承認 | 申請内容を承認 | 次ステップまたは完了 |
| 却下 | 申請を否認 | 申請終了 |
| 差戻し | 修正が必要 | 申請者または前ステップに戻る |

**入力項目**:
| 項目名 | 必須 | 形式 | 制約 | 備考 |
|--------|------|------|------|------|
| アクション | ○ | 選択 | 承認/却下/差戻し | - |
| コメント | ○ | 文字列 | 1-1000文字 | 判断理由必須 |
| 追加ファイル | △ | ファイル | 最大5MB | 根拠資料等 |
| 差戻し先 | △ | 選択 | 承認ルート内 | 差戻し時のみ |

#### 2.2.2 承認待ち一覧機能
**機能ID**: WF-011
**優先度**: High

**機能概要**:
承認者に割り当てられた承認待ち申請を一覧表示する機能

**詳細要件**:
- 承認待ち案件の一覧表示
- 緊急度による並び替え
- 申請種別別フィルタ
- 申請者別フィルタ
- 待機時間の表示
- 一括承認機能（同種申請）
- 期限超過アラート

**表示項目**:
| 項目名 | 説明 | 表示形式 |
|--------|------|----------|
| 緊急度 | 申請の優先度 | カラータグ |
| 申請番号 | 申請の識別番号 | WF-YYYYMMDD-XXXX |
| 申請種別 | 申請の分類 | アイコン + テキスト |
| 申請タイトル | 申請内容の要約 | テキスト |
| 申請者 | 申請を提出したユーザー | 名前 + 所属部署 |
| 申請日 | 申請が提出された日 | YYYY-MM-DD |
| 待機時間 | 承認待ちの経過時間 | X日Yh時間 |

#### 2.2.3 代理承認機能
**機能ID**: WF-012
**優先度**: Medium

**機能概要**:
休暇や出張時に他のユーザーが代理で承認を行う機能

**詳細要件**:
- 代理承認者の設定
- 代理期間の指定
- 対象申請種別の限定
- 代理承認権限の制限（金額上限等）
- 代理承認の履歴記録

**設定項目**:
| 項目名 | 必須 | 形式 | 制約 | 備考 |
|--------|------|------|------|------|
| 代理承認者 | ○ | ユーザー選択 | 同一会社内 | - |
| 開始日 | ○ | 日付 | 当日以降 | - |
| 終了日 | ○ | 日付 | 開始日以降 | - |
| 対象申請種別 | △ | 複数選択 | 登録済み種別 | 未選択時は全種別 |
| 承認上限金額 | △ | 数値 | 0以上 | 金額制限がある場合 |
| 代理理由 | ○ | 文字列 | 1-200文字 | 監査用 |

### 2.3 ワークフロー管理機能

#### 2.3.1 申請種別管理機能
**機能ID**: WF-020
**優先度**: High

**機能概要**:
申請種別と動的フォームの定義・管理を行う機能

**詳細要件**:
- 申請種別の作成・編集・削除
- 動的フォームスキーマの定義
- フォーム項目の型指定（テキスト、数値、日付、選択等）
- バリデーションルールの設定
- 承認ルートテンプレートの関連付け

**フォーム項目型**:
| 項目型 | 説明 | 設定可能属性 |
|--------|------|--------------|
| text | 一行テキスト | 最大長、必須、正規表現 |
| textarea | 複数行テキスト | 最大長、行数、必須 |
| number | 数値 | 最小値、最大値、小数点 |
| date | 日付 | 最小日、最大日、必須 |
| select | 選択肢 | 選択肢リスト、複数選択 |
| checkbox | チェックボックス | デフォルト値 |
| file | ファイル | 最大サイズ、許可形式 |

#### 2.3.2 承認ルート管理機能
**機能ID**: WF-021
**優先度**: High

**機能概要**:
申請種別・部署別の承認ルートを定義・管理する機能

**詳細要件**:
- 承認ルートの作成・編集・削除
- ステップ別承認者の設定
- 条件分岐ルールの定義（金額、緊急度等）
- 並列承認の設定
- エスカレーションルールの設定

**ルート設定項目**:
| 項目名 | 説明 | 設定例 |
|--------|------|--------|
| ルート名 | 承認ルートの名称 | 「営業部_出張申請_標準」 |
| 対象申請種別 | 適用する申請種別 | 出張申請 |
| 対象部署 | 適用する部署 | 営業部 |
| 承認ステップ | 順序別承認者設定 | 1.直属上司 → 2.部長 → 3.役員 |
| 条件分岐 | 金額等による分岐 | 10万円以上は役員承認必須 |
| 期限設定 | ステップ別期限 | 各ステップ3営業日 |

#### 2.3.3 統計・レポート機能
**機能ID**: WF-022
**優先度**: Medium

**機能概要**:
申請・承認の統計情報とレポートを提供する機能

**詳細要件**:
- ダッシュボード表示
- 申請種別別統計
- 部署別統計
- 承認者別統計
- 処理時間分析
- レポートエクスポート（Excel、PDF）

**統計項目**:
| 統計種別 | 詳細 | 更新頻度 |
|----------|------|----------|
| 申請件数 | 日別、月別、年別 | リアルタイム |
| 承認率 | 承認/却下/差戻し率 | 日次 |
| 処理時間 | 平均、最大、最小 | 日次 |
| 滞留案件 | 承認待ち期間超過 | リアルタイム |

### 2.4 通知機能

#### 2.4.1 リアルタイム通知機能
**機能ID**: WF-030
**優先度**: Medium

**機能概要**:
申請・承認の状況変化をリアルタイムで通知する機能

**詳細要件**:
- WebSocket通知
- ブラウザ通知
- システム内通知
- 通知履歴管理
- 通知設定のカスタマイズ

**通知タイミング**:
| イベント | 通知対象 | 通知内容 |
|----------|----------|----------|
| 申請提出 | 次承認者 | 新しい承認依頼 |
| 承認完了 | 申請者 | 承認完了通知 |
| 却下・差戻し | 申請者 | 却下・差戻し通知 |
| 期限超過 | 承認者、管理者 | 期限超過アラート |

#### 2.4.2 メール通知機能
**機能ID**: WF-031
**優先度**: Low

**機能概要**:
重要な通知をメールで送信する機能

**詳細要件**:
- HTML形式メール
- テンプレート管理
- 送信タイミング設定
- 配信失敗時の再送

---

## 3. 非機能要件

### 3.1 性能要件

#### 3.1.1 応答時間
| 操作 | 目標応答時間 | 最大許容時間 |
|------|--------------|--------------|
| 画面表示 | 1.5秒以内 | 3秒以内 |
| 申請提出 | 2秒以内 | 5秒以内 |
| 承認処理 | 1秒以内 | 3秒以内 |
| 検索処理 | 3秒以内 | 10秒以内 |
| レポート出力 | 10秒以内 | 30秒以内 |

#### 3.1.2 スループット
- 同時接続ユーザー数：100ユーザー
- 1日の申請処理件数：1,000件
- ピークタイム処理能力：50件/分

#### 3.1.3 リソース使用量
- CPU使用率：平常時30%以下、ピーク時70%以下
- メモリ使用量：2GB以下
- ディスク使用量：年間50GB増加

### 3.2 可用性要件

#### 3.2.1 システム稼働率
- 目標稼働率：99.5%以上
- 計画停止：月1回、2時間以内
- 障害復旧時間：4時間以内

#### 3.2.2 データ整合性
- データ損失：許容しない
- バックアップ：日次自動バックアップ
- 復旧時間：4時間以内

### 3.3 拡張性要件

#### 3.3.1 ユーザー数拡張
- 初期：300ユーザー
- 3年後：1,000ユーザー
- 5年後：3,000ユーザー

#### 3.3.2 データ量拡張
- 初期：10,000件/年
- 3年後：50,000件/年
- 5年後：100,000件/年

### 3.4 互換性要件

#### 3.4.1 ブラウザ対応
- Chrome 90以降
- Firefox 88以降
- Safari 14以降
- Edge 90以降

#### 3.4.2 デバイス対応
- デスクトップ：1024px以上
- タブレット：768px - 1023px
- モバイル：320px - 767px

---

## 4. ユーザーインターフェース

### 4.1 画面構成

#### 4.1.1 ワークフローダッシュボード
**画面ID**: UI-001
**アクセス権限**: 全ユーザー

**画面要素**:
- 統計カード（承認待ち、今月申請、今月承認、平均処理時間）
- 申請種別別統計グラフ（ドーナツチャート）
- 月別申請推移グラフ（ラインチャート）
- 最近の活動タイムライン
- クイックアクション（新規申請、承認待ち確認）

**レスポンシブ対応**:
- デスクトップ：4列レイアウト
- タブレット：2列レイアウト
- モバイル：1列レイアウト

#### 4.1.2 申請作成画面
**画面ID**: UI-002
**アクセス権限**: 申請権限を持つユーザー

**画面要素**:
- 申請種別選択（カード形式、アイコン付き）
- 基本情報フォーム（タイトル、緊急度、期限）
- 動的申請フォーム（申請種別により変化）
- ファイル添付エリア（ドラッグ&ドロップ対応）
- 承認ルートプレビュー（フローチャート形式）
- アクションボタン（下書き保存、申請提出、プレビュー）

**バリデーション**:
- リアルタイムバリデーション
- エラーメッセージの明確表示
- 必須項目の視覚的強調

#### 4.1.3 承認画面
**画面ID**: UI-003
**アクセス権限**: 承認権限を持つユーザー

**画面要素**:
- フィルタ・検索エリア
- 承認待ち一覧テーブル
- 緊急度・待機時間の視覚的表示
- 一括操作ボタン
- 申請詳細ダイアログ
- 承認アクションボタン（承認、却下、差戻し）

**ソート・フィルタ**:
- 緊急度ソート（デフォルト）
- 申請日ソート
- 待機時間ソート
- 申請種別フィルタ
- 申請者フィルタ

### 4.2 操作フロー

#### 4.2.1 申請提出フロー
```
1. ダッシュボード表示
2. 「新規申請」ボタンクリック
3. 申請種別選択
4. 動的フォーム表示
5. 申請内容入力
6. ファイル添付（任意）
7. 承認ルート確認
8. 内容確認・プレビュー
9. 申請提出
10. 申請番号表示・完了
```

#### 4.2.2 承認処理フロー
```
1. 承認待ち一覧表示
2. 申請選択・詳細確認
3. 添付ファイル確認
4. 承認判断
5. コメント入力
6. アクション実行（承認/却下/差戻し）
7. 処理完了・次ステップ移行
```

### 4.3 エラーハンドリング

#### 4.3.1 バリデーションエラー
- フィールド単位のエラー表示
- エラーメッセージの多言語対応
- エラー箇所への自動スクロール

#### 4.3.2 システムエラー
- ユーザーフレンドリーなエラーメッセージ
- エラー詳細の管理者通知
- 復旧方法の案内

---

## 5. ビジネスルール

### 5.1 申請ルール

#### 5.1.1 申請資格
- 有効なユーザーアカウントを持つ社員
- 申請種別に対する権限を持つユーザー
- 休職中・退職予定者は申請不可

#### 5.1.2 申請制限
- 同一申請種別の重複申請制限（有給申請等）
- 申請可能期間の制限（事前申請期限）
- 申請金額の上限設定（部署・役職別）

#### 5.1.3 申請キャンセル
- 承認前の申請：申請者がキャンセル可能
- 承認後の申請：管理者のみキャンセル可能
- キャンセル理由の記録必須

### 5.2 承認ルール

#### 5.2.1 承認者決定
- 組織階層に基づく自動設定
- 申請種別・金額による分岐
- 承認者不在時の代理承認

#### 5.2.2 承認期限
- ステップ別承認期限の設定
- 期限超過時のエスカレーション
- 緊急申請の期限短縮

#### 5.2.3 承認順序
- 原則として順次承認
- 並列承認の例外設定
- 条件分岐による承認スキップ

### 5.3 権限ルール

#### 5.3.1 申請権限
| 権限レベル | 申請可能種別 | 制限 |
|------------|--------------|------|
| 一般社員 | 有給、出張 | 金額制限あり |
| 主任・係長 | 上記 + 購買 | 100万円まで |
| 課長・部長 | 上記 + 投資 | 500万円まで |
| 役員 | 全種別 | 制限なし |

#### 5.3.2 承認権限
| 役職 | 承認可能範囲 | 承認上限 |
|------|--------------|----------|
| 主任・係長 | 部下の申請 | 50万円 |
| 課長 | 課内の申請 | 200万円 |
| 部長 | 部内の申請 | 1000万円 |
| 役員 | 全社の申請 | 制限なし |

---

## 6. 外部インターフェース

### 6.1 システム連携

#### 6.1.1 人事システム連携
**連携目的**: 組織情報・勤怠情報の取得
**連携方式**: REST API
**連携データ**:
- 組織構造（部署、役職）
- 有給残日数
- 勤務スケジュール

#### 6.1.2 会計システム連携
**連携目的**: 予算確認・仕訳計上
**連携方式**: バッチ処理
**連携データ**:
- 予算残高照会
- 承認済み申請の仕訳データ送信

#### 6.1.3 メールシステム連携
**連携目的**: 通知メール送信
**連携方式**: SMTP
**連携データ**:
- 承認依頼メール
- 処理完了メール
- 期限超過アラートメール

### 6.2 ファイル管理

#### 6.2.1 ファイルストレージ
**保存場所**: ローカルファイルサーバー
**保存形式**: 暗号化保存
**アクセス制御**: 申請関係者のみ

#### 6.2.2 ファイル形式制限
**許可形式**:
- 文書：PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX
- 画像：JPEG, PNG, GIF
- その他：TXT, CSV

**サイズ制限**:
- 1ファイル：最大10MB
- 申請あたり：最大50MB

---

## 7. セキュリティ要件

### 7.1 認証・認可

#### 7.1.1 認証方式
- JWT認証（既存システム連携）
- セッション管理
- 多要素認証（管理者）

#### 7.1.2 認可制御
- RBAC（Role-Based Access Control）
- リソースレベル権限制御
- 動的権限チェック

### 7.2 データ保護

#### 7.2.1 暗号化
- 通信暗号化：TLS 1.3
- データベース暗号化：AES-256
- ファイル暗号化：AES-256

#### 7.2.2 個人情報保護
- 個人情報の最小限収集
- アクセスログの記録
- データ保存期間の制限

### 7.3 監査・ログ

#### 7.3.1 操作ログ
- 全操作の記録
- 改ざん防止機能
- ログ保存期間：5年

#### 7.3.2 監査証跡
- 承認プロセスの完全記録
- 権限変更の記録
- システム変更の記録

---

## 8. 運用要件

### 8.1 システム運用

#### 8.1.1 監視項目
- システム稼働状況
- 性能指標（応答時間、スループット）
- エラー発生状況
- セキュリティインシデント

#### 8.1.2 メンテナンス
- 定期メンテナンス：月1回
- 緊急メンテナンス：4時間以内対応
- システム更新：四半期ごと

### 8.2 データ管理

#### 8.2.1 バックアップ
- 日次：増分バックアップ
- 週次：フルバックアップ
- 月次：長期保存バックアップ

#### 8.2.2 データ保存期間
| データ種別 | 保存期間 | 備考 |
|------------|----------|------|
| 申請データ | 7年 | 税務関連 |
| 承認履歴 | 7年 | 監査要件 |
| ログデータ | 5年 | セキュリティ要件 |
| 添付ファイル | 3年 | ストレージ容量考慮 |

### 8.3 ユーザーサポート

#### 8.3.1 ヘルプデスク
- 操作方法の問い合わせ対応
- 障害時の一次対応
- マニュアル・FAQ整備

#### 8.3.2 ユーザー教育
- 新規ユーザー向け研修
- 機能更新時の説明会
- 操作マニュアルの提供

---

## 📋 承認履歴

| 版数 | 日付 | 変更内容 | 作成者 | 承認者 |
|------|------|----------|--------|--------|
| 1.0 | 2025-09-27 | 初版作成 | システム開発チーム | - |

---

## 📚 関連文書

- [システム設計書](../システム設計書.md)
- [データベース設計書](../データベース設計書.md)
- [API設計書](../API設計書.md)
- [セキュリティ設計書](../セキュリティ設計書.md)

---

**文書の機密レベル**: 社内限り
**次回レビュー予定**: 2025-10-27