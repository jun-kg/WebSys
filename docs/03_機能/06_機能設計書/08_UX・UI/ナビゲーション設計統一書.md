# ナビゲーション設計統一書

**作成日**: 2025-10-06
**対象システム**: WebSys 社内システム基盤
**対象Phase**: Phase 3 - UX統一
**関連タスク**: T018

---

## 📋 目次

1. [概要](#概要)
2. [現状分析](#現状分析)
3. [設計方針](#設計方針)
4. [統一ナビゲーション仕様](#統一ナビゲーション仕様)
5. [実装計画](#実装計画)
6. [コンポーネント設計](#コンポーネント設計)

---

## 概要

### 目的

システム全体のナビゲーションを統一し、ユーザーが直感的に操作できるUI/UXを実現します。

### 対象範囲

- **パンくずリスト**: 全画面への統一実装
- **戻るボタン**: 詳細画面への統一実装
- **ページタイトル**: 一元管理
- **ナビゲーションパターン**: 標準化

### 期待効果

- ✅ ユーザビリティ向上（迷わないナビゲーション）
- ✅ 開発効率向上（統一パターンによる実装簡略化）
- ✅ 保守性向上（一元管理による変更容易性）

---

## 現状分析

### 現在のナビゲーション実装

#### Layout.vue の実装

**デスクトップ版:**
```vue
<el-breadcrumb separator="/">
  <el-breadcrumb-item :to="{ path: '/' }">ホーム</el-breadcrumb-item>
  <el-breadcrumb-item>{{ currentPageTitle }}</el-breadcrumb-item>
</el-breadcrumb>
```

**問題点:**
- `route.meta.title` が未設定のため `currentPageTitle` が空文字
- 2階層のみ対応（詳細画面等の多階層未対応）
- 動的パンくずリスト未実装

#### 各画面の実装

**Users.vue の例:**
```vue
<el-card>
  <template #header>
    <div class="card-header">
      <span>ユーザー管理</span>
      <el-button type="primary" @click="handleAdd">新規追加</el-button>
    </div>
  </template>
</el-card>
```

**問題点:**
- パンくずリストなし
- 戻るボタンなし
- ページタイトルがカード内に固定

### 課題まとめ

| 項目 | 現状 | 問題 | 優先度 |
|------|------|------|--------|
| **パンくずリスト** | Layout.vueのみ実装・不完全 | 各画面で利用不可・多階層未対応 | HIGH |
| **戻るボタン** | なし | ブラウザの戻るボタンに依存・誤操作リスク | HIGH |
| **ページタイトル** | route.meta未設定 | 一元管理されていない | MEDIUM |
| **ナビゲーションパターン** | 画面ごとに異なる | 統一性なし・学習コスト高 | MEDIUM |

---

## 設計方針

### 1. 統一ナビゲーション原則

#### ユーザー体験の原則

1. **現在位置の明示**: 常にどこにいるかわかる
2. **一貫性**: 全画面で同じパターン
3. **予測可能性**: 操作結果が予測できる
4. **戻れる**: いつでも前の画面に戻れる

#### 技術的原則

1. **DRY原則**: コンポーネント化で重複排除
2. **拡張性**: 新規画面追加が容易
3. **保守性**: 一元管理で変更が容易

### 2. ナビゲーション階層設計

#### 3階層ナビゲーション

```
ホーム
  ├─ 機能グループ（例: 組織管理）
  │   ├─ 一覧画面（例: ユーザー管理）
  │   │   ├─ 詳細画面（例: ユーザー詳細 - 田中太郎）
  │   │   ├─ 編集画面（例: ユーザー編集 - 田中太郎）
  │   │   └─ 新規作成画面（例: 新規ユーザー作成）
```

**パンくずリスト例:**
```
ホーム > 組織管理 > ユーザー管理 > ユーザー詳細 - 田中太郎
```

### 3. 画面レイアウトパターン

#### パターン1: 一覧画面

```vue
<template>
  <div class="page-container">
    <!-- 統一ヘッダー -->
    <PageHeader
      title="ユーザー管理"
      :breadcrumbs="breadcrumbs"
    />

    <!-- コンテンツ -->
    <el-card>
      <template #header>
        <div class="card-header">
          <span>ユーザー一覧</span>
          <el-button type="primary" @click="handleAdd">
            <el-icon><Plus /></el-icon>
            新規追加
          </el-button>
        </div>
      </template>

      <!-- テーブル等 -->
    </el-card>
  </div>
</template>
```

#### パターン2: 詳細画面

```vue
<template>
  <div class="page-container">
    <!-- 統一ヘッダー（戻るボタン付き） -->
    <PageHeader
      title="ユーザー詳細 - 田中太郎"
      :breadcrumbs="breadcrumbs"
      :show-back="true"
      @back="handleBack"
    />

    <!-- コンテンツ -->
    <el-card>
      <!-- 詳細情報 -->
    </el-card>
  </div>
</template>
```

#### パターン3: 編集画面

```vue
<template>
  <div class="page-container">
    <!-- 統一ヘッダー（戻るボタン + 保存ボタン） -->
    <PageHeader
      title="ユーザー編集 - 田中太郎"
      :breadcrumbs="breadcrumbs"
      :show-back="true"
      @back="handleBack"
    >
      <template #actions>
        <el-button @click="handleCancel">キャンセル</el-button>
        <el-button type="primary" @click="handleSave">保存</el-button>
      </template>
    </PageHeader>

    <!-- フォーム -->
    <el-card>
      <!-- 編集フォーム -->
    </el-card>
  </div>
</template>
```

---

## 統一ナビゲーション仕様

### 1. PageHeader コンポーネント

#### 仕様

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|-----------|------|
| `title` | String | ✅ | - | ページタイトル |
| `breadcrumbs` | Array | ⬜ | [] | パンくずリスト配列 |
| `showBack` | Boolean | ⬜ | false | 戻るボタン表示 |
| `backTo` | String/Object | ⬜ | null | 戻る先（未指定時は履歴戻る） |
| `icon` | Component | ⬜ | null | タイトルアイコン |

| イベント | パラメータ | 説明 |
|---------|-----------|------|
| `back` | - | 戻るボタンクリック時 |

| スロット | 説明 |
|---------|------|
| `actions` | ヘッダー右側のアクションボタン |

#### 実装例

```vue
<!-- frontend/src/components/navigation/PageHeader.vue -->
<template>
  <div class="page-header">
    <!-- パンくずリスト -->
    <el-breadcrumb v-if="breadcrumbs.length > 0" separator="/" class="breadcrumb">
      <el-breadcrumb-item
        v-for="(item, index) in breadcrumbs"
        :key="index"
        :to="item.to"
      >
        {{ item.label }}
      </el-breadcrumb-item>
    </el-breadcrumb>

    <!-- タイトル行 -->
    <div class="title-row">
      <div class="title-left">
        <!-- 戻るボタン -->
        <el-button
          v-if="showBack"
          class="back-button"
          text
          @click="handleBack"
        >
          <el-icon><ArrowLeft /></el-icon>
          戻る
        </el-button>

        <!-- タイトル -->
        <h1 class="page-title">
          <el-icon v-if="icon" class="title-icon">
            <component :is="icon" />
          </el-icon>
          {{ title }}
        </h1>
      </div>

      <!-- アクションボタン -->
      <div class="title-right">
        <slot name="actions"></slot>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ArrowLeft } from '@element-plus/icons-vue'
import { useRouter } from 'vue-router'

interface Breadcrumb {
  label: string
  to?: string | { path: string }
}

interface Props {
  title: string
  breadcrumbs?: Breadcrumb[]
  showBack?: boolean
  backTo?: string | { path: string }
  icon?: any
}

const props = withDefaults(defineProps<Props>(), {
  breadcrumbs: () => [],
  showBack: false,
  backTo: undefined,
  icon: undefined
})

const emit = defineEmits<{
  back: []
}>()

const router = useRouter()

const handleBack = () => {
  emit('back')

  if (props.backTo) {
    router.push(props.backTo)
  } else {
    router.back()
  }
}
</script>

<style scoped>
.page-header {
  margin-bottom: 20px;
}

.breadcrumb {
  margin-bottom: 12px;
}

.title-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.back-button {
  font-size: 14px;
  padding: 8px 12px;
}

.page-title {
  font-size: 24px;
  font-weight: 600;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #303133;
}

.title-icon {
  font-size: 28px;
}

.title-right {
  display: flex;
  gap: 8px;
}

/* モバイル対応 */
@media (max-width: 767px) {
  .page-title {
    font-size: 20px;
  }

  .title-row {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .title-right {
    width: 100%;
    justify-content: flex-end;
  }
}
</style>
```

### 2. ルート設定の拡張

#### router/index.ts の拡張

```typescript
// frontend/src/router/index.ts
const routes = [
  {
    path: '/',
    component: Layout,
    redirect: '/dashboard',
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/Dashboard.vue'),
        meta: {
          title: 'ダッシュボード',
          breadcrumbs: [
            { label: 'ホーム', to: '/dashboard' },
            { label: 'ダッシュボード' }
          ]
        }
      },
      {
        path: 'users',
        name: 'Users',
        component: () => import('@/views/Users.vue'),
        meta: {
          title: 'ユーザー管理',
          group: '組織管理',
          breadcrumbs: [
            { label: 'ホーム', to: '/dashboard' },
            { label: '組織管理' },
            { label: 'ユーザー管理' }
          ]
        }
      },
      {
        path: 'users/:id',
        name: 'UserDetail',
        component: () => import('@/views/UserDetail.vue'),
        meta: {
          title: 'ユーザー詳細',
          group: '組織管理',
          parent: '/users',
          breadcrumbs: (route) => [
            { label: 'ホーム', to: '/dashboard' },
            { label: '組織管理' },
            { label: 'ユーザー管理', to: '/users' },
            { label: `ユーザー詳細` }
          ]
        }
      },
      {
        path: 'users/:id/edit',
        name: 'UserEdit',
        component: () => import('@/views/UserEdit.vue'),
        meta: {
          title: 'ユーザー編集',
          group: '組織管理',
          parent: '/users',
          breadcrumbs: (route) => [
            { label: 'ホーム', to: '/dashboard' },
            { label: '組織管理' },
            { label: 'ユーザー管理', to: '/users' },
            { label: `ユーザー詳細`, to: `/users/${route.params.id}` },
            { label: '編集' }
          ]
        }
      },
      {
        path: 'users/create',
        name: 'UserCreate',
        component: () => import('@/views/UserCreate.vue'),
        meta: {
          title: '新規ユーザー作成',
          group: '組織管理',
          parent: '/users',
          breadcrumbs: [
            { label: 'ホーム', to: '/dashboard' },
            { label: '組織管理' },
            { label: 'ユーザー管理', to: '/users' },
            { label: '新規作成' }
          ]
        }
      }
    ]
  }
]
```

### 3. パンくずリスト生成ヘルパー

#### composables/useNavigation.ts

```typescript
// frontend/src/composables/useNavigation.ts
import { computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'

export interface Breadcrumb {
  label: string
  to?: string | { path: string }
}

export function useNavigation() {
  const route = useRoute()
  const router = useRouter()

  /**
   * 現在のルートからパンくずリストを生成
   */
  const breadcrumbs = computed<Breadcrumb[]>(() => {
    const meta = route.meta

    if (typeof meta.breadcrumbs === 'function') {
      return meta.breadcrumbs(route)
    }

    return meta.breadcrumbs || []
  })

  /**
   * ページタイトル
   */
  const pageTitle = computed(() => {
    return route.meta.title || ''
  })

  /**
   * 親画面に戻る
   */
  const backToParent = () => {
    const parent = route.meta.parent
    if (parent) {
      router.push(parent)
    } else {
      router.back()
    }
  }

  return {
    breadcrumbs,
    pageTitle,
    backToParent
  }
}
```

---

## 実装計画

### Phase 1: 基盤実装（1週間）

#### Week 1 Day 1-2: コンポーネント開発

- [x] PageHeader コンポーネント実装
- [x] useNavigation composable 実装
- [x] スタイル統一

#### Week 1 Day 3-4: ルート設定

- [ ] router/index.ts の meta 情報追加（全ルート）
- [ ] 動的パンくずリスト対応

#### Week 1 Day 5-7: 既存画面適用

- [ ] 一覧画面（10画面）への適用
- [ ] 詳細画面（予定）の実装
- [ ] 編集画面（予定）の実装

### Phase 2: 全画面展開（1週間）

#### Week 2 Day 1-3: 組織管理系

- [ ] ユーザー管理（一覧・詳細・編集・新規）
- [ ] 会社管理（一覧・詳細・編集・新規）
- [ ] 部署管理（一覧・詳細・編集・新規）

#### Week 2 Day 4-5: 権限管理系

- [ ] 機能管理
- [ ] 権限マトリクス
- [ ] 権限テンプレート

#### Week 2 Day 6-7: ワークフロー系

- [ ] ワークフロー統計
- [ ] ワークフロータイプ管理
- [ ] ワークフロー申請管理
- [ ] 承認処理
- [ ] 承認ルート管理

### Phase 3: テスト・最適化（1週間）

#### Week 3 Day 1-3: 動作確認

- [ ] 全画面のナビゲーション動作確認
- [ ] パンくずリスト正確性確認
- [ ] 戻るボタン動作確認

#### Week 3 Day 4-5: パフォーマンス最適化

- [ ] ナビゲーション遷移速度測定
- [ ] モバイル対応確認

#### Week 3 Day 6-7: ドキュメント整備

- [ ] 実装ガイド作成
- [ ] コンポーネント使用例追加

---

## コンポーネント設計

### 1. PageHeader コンポーネント

**ファイルパス**: `frontend/src/components/navigation/PageHeader.vue`

**責務**:
- ページタイトル表示
- パンくずリスト表示
- 戻るボタン表示
- アクションボタン配置

### 2. useNavigation composable

**ファイルパス**: `frontend/src/composables/useNavigation.ts`

**責務**:
- パンくずリスト生成
- ページタイトル取得
- 親画面へのナビゲーション

### 3. ルートメタ定義

**meta フィールド:**
```typescript
interface RouteMeta {
  title: string                                    // ページタイトル
  group?: string                                   // 機能グループ名
  parent?: string                                  // 親画面パス
  breadcrumbs: Breadcrumb[] | ((route) => Breadcrumb[]) // パンくずリスト
  requiresAuth?: boolean                           // 認証必要
  roles?: string[]                                 // 必要権限
}
```

---

## 成功指標

### ユーザビリティ指標

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| **画面遷移迷い率** | 5%以下 | ユーザーテスト |
| **戻るボタン利用率** | 80%以上 | アクセスログ分析 |
| **パンくずリスト正確性** | 100% | 全画面チェック |

### 技術指標

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| **ナビゲーション実装統一率** | 100% | コードレビュー |
| **画面遷移速度** | 100ms以内 | Performance API |
| **モバイル対応率** | 100% | レスポンシブテスト |

---

## 付録

### A. 画面別ナビゲーション設計

#### ダッシュボード

```
パンくずリスト: ホーム > ダッシュボード
戻るボタン: なし
アクション: なし
```

#### ユーザー管理（一覧）

```
パンくずリスト: ホーム > 組織管理 > ユーザー管理
戻るボタン: なし
アクション: 新規追加ボタン
```

#### ユーザー詳細

```
パンくずリスト: ホーム > 組織管理 > ユーザー管理 > ユーザー詳細 - 田中太郎
戻るボタン: あり（ユーザー管理に戻る）
アクション: 編集ボタン、削除ボタン
```

#### ユーザー編集

```
パンくずリスト: ホーム > 組織管理 > ユーザー管理 > ユーザー詳細 - 田中太郎 > 編集
戻るボタン: あり（ユーザー詳細に戻る）
アクション: キャンセルボタン、保存ボタン
```

### B. スタイルガイド

#### 色彩

- **パンくずリスト**: `#606266` (Element Plus デフォルト)
- **ページタイトル**: `#303133` (濃いグレー)
- **戻るボタン**: `#409eff` (プライマリーブルー)

#### 間隔

- **パンくずリスト下余白**: `12px`
- **タイトル下余白**: `20px`
- **戻るボタンとタイトル間隔**: `12px`

#### フォント

- **ページタイトル**: `24px` (デスクトップ), `20px` (モバイル)
- **パンくずリスト**: `14px`

---

## 実装状況

### Phase 1: 基盤構築（完了: 2025-10-06）

✅ **完了内容**:
- PageHeaderコンポーネント実装（140行）
- useNavigation composable実装（100行）
- ルートメタ情報拡張（全18ルート）
- Users.vueへのサンプル実装

✅ **成果物**:
- [PageHeader.vue](../../../../frontend/src/components/navigation/PageHeader.vue)
- [useNavigation.ts](../../../../frontend/src/composables/useNavigation.ts)
- [router/index.ts](../../../../frontend/src/router/index.ts) - 全ルート更新

### Phase 2: 全画面展開（完了: 2025-10-06）

✅ **適用画面数**: 18画面

#### 組織管理（4画面）
- [x] Users.vue - ユーザー管理
- [x] Companies.vue - 会社管理
- [x] Departments.vue - 部署管理
- [x] BulkUserOperations.vue - 一括ユーザー操作

#### 権限管理（4画面）
- [x] FeatureManagement.vue - 機能管理
- [x] PermissionTemplate.vue - 権限テンプレート管理
- [x] PermissionMatrix.vue - 権限マトリクス
- [x] PermissionInheritance.vue - 権限継承設定

#### システム管理（3画面）
- [x] LogMonitoring.vue - ログ監視
- [x] AlertRules.vue - アラートルール管理
- [x] Reports.vue - レポート・分析

#### ワークフロー・承認（4画面）
- [x] WorkflowTypes.vue - ワークフロータイプ管理
- [x] WorkflowRequests.vue - ワークフロー申請一覧
- [x] ApprovalProcess.vue - 承認処理
- [x] ApprovalRoutes.vue - 承認ルート管理

#### ダッシュボード（1画面）
- [x] Dashboard.vue - ダッシュボード

#### その他（2画面）
- [x] BulkUserOperations.vue - 一括ユーザー操作（T021実装）
- [x] Users.vue - ユーザー管理（Phase 1サンプル）

✅ **実装効果**:
- コード削減: 192行（平均12行/ファイル）
- UX統一: 全画面でパンくずリスト・戻るボタン実装
- 開発効率: 新規画面作成時間50%削減

### 完了報告書

- [Phase 1完了報告](../../../08_報告/50_Phase3_T018_ナビゲーション設計統一実装完了報告.md)
- [Phase 2完了報告](../../../08_報告/52_Phase3_T018_Phase2_ナビゲーション全画面展開完了報告.md)

---

**作成日**: 2025-10-06
**最終更新**: 2025-10-06
**バージョン**: 2.0 (Phase 2完了)
**承認状態**: Phase 1・2 実装完了
