# ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“çµ±ä¸€è¨­è¨ˆæ›¸

**ä½œæˆæ—¥**: 2025-10-05
**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **: WebSys ç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤
**å¯¾è±¡Phase**: Phase 3 - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®çµ±ä¸€
**é–¢é€£ã‚¿ã‚¹ã‚¯**: T017, T018

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ç¾çŠ¶åˆ†æ](#ç¾çŠ¶åˆ†æ)
3. [T017: ãƒ‡ãƒ¢æ©Ÿèƒ½ã®ç’°å¢ƒåˆ†é›¢](#t017-ãƒ‡ãƒ¢æ©Ÿèƒ½ã®ç’°å¢ƒåˆ†é›¢)
4. [T018: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆçµ±ä¸€](#t018-ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆçµ±ä¸€)
5. [å®Ÿè£…ä»•æ§˜](#å®Ÿè£…ä»•æ§˜)
6. [UI/UXã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#uiuxã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
7. [å®Ÿè£…è¨ˆç”»](#å®Ÿè£…è¨ˆç”»)

---

## æ¦‚è¦

### ç›®çš„
ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’çµ±ä¸€ã—ã€ä»¥ä¸‹ã®èª²é¡Œã‚’è§£æ±ºã—ã¾ã™ï¼š

1. **ãƒ‡ãƒ¢æ©Ÿèƒ½ã®æ··åœ¨**: æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ‡ãƒ¢æ©Ÿèƒ½ãŒæ®‹å­˜
2. **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸çµ±ä¸€**: ç”»é¢é–“ã®é·ç§»ãŒä¸€è²«ã—ã¦ã„ãªã„
3. **æ“ä½œã®éåŠ¹ç‡æ€§**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿·ã„ã‚„ã™ã„è¨­è¨ˆ

### å¯¾è±¡ç¯„å›²
- **T017**: ãƒ‡ãƒ¢æ©Ÿèƒ½ãƒ»ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã®ç’°å¢ƒåˆ†é›¢
- **T018**: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä½“ç³»ã®çµ±ä¸€ãƒ»ä¸€è²«æ€§ç¢ºä¿

### æœŸå¾…åŠ¹æœ
- âœ… æœ¬ç•ªç’°å¢ƒã®ä¿¡é ¼æ€§å‘ä¸Šï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿æ··å…¥ãƒªã‚¹ã‚¯æ’é™¤ï¼‰
- âœ… æ“ä½œåŠ¹ç‡30%å‘ä¸Šï¼ˆä¸€è²«ã—ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- âœ… å­¦ç¿’ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼ˆçµ±ä¸€ã•ã‚ŒãŸUI/UXï¼‰
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦å‘ä¸Š

---

## ç¾çŠ¶åˆ†æ

### ç¾çŠ¶ã®å•é¡Œç‚¹

#### 1. ãƒ‡ãƒ¢æ©Ÿèƒ½ã®æ··åœ¨

| é …ç›® | ç¾çŠ¶ | å•é¡Œ |
|------|------|------|
| **ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿** | seed.tsã«æ··åœ¨ | æœ¬ç•ªç’°å¢ƒã«æŠ•å…¥ãƒªã‚¹ã‚¯ |
| **ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼** | é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ« | å‰Šé™¤æ¼ã‚Œãƒªã‚¹ã‚¯ |
| **ç’°å¢ƒåˆ¤å®š** | ä¸æ˜ç¢º | èª¤æ“ä½œãƒªã‚¹ã‚¯ |
| **è¡¨ç¤ºåˆ¶å¾¡** | ãªã— | ãƒ‡ãƒ¢æ©Ÿèƒ½ãŒå¸¸æ™‚è¡¨ç¤º |

**å…·ä½“ä¾‹**:
```typescript
// prisma/seed.ts - ç¾çŠ¶ã®å•é¡Œ
// ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã¨æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãŒæ··åœ¨
const demoUser = await prisma.users.create({
  data: {
    username: 'demo',
    email: 'demo@example.com',
    role: 'USER'
    // æœ¬ç•ªç’°å¢ƒã§ã‚‚ä½œæˆã•ã‚Œã¦ã—ã¾ã†
  }
})
```

#### 2. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸çµ±ä¸€

| å•é¡Œç‚¹ | å½±éŸ¿ |
|-------|------|
| **ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆä¸çµ±ä¸€** | ç¾åœ¨ä½ç½®ãŒä¸æ˜ |
| **ãƒ¡ãƒ‹ãƒ¥ãƒ¼éšå±¤ãƒãƒ©ãƒãƒ©** | æ©Ÿèƒ½ãŒè¦‹ã¤ã‘ã«ãã„ |
| **æˆ»ã‚‹ãƒœã‚¿ãƒ³ä¸çµ±ä¸€** | æ“ä½œãŒäºˆæ¸¬ä¸èƒ½ |
| **ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ¬ å¦‚** | ä½œæ¥­åŠ¹ç‡ä½ä¸‹ |

**ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¸çµ±ä¸€ã®ä¾‹**:
```
ç”»é¢A: ãƒ›ãƒ¼ãƒ  > ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† > ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
ç”»é¢B: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
ç”»é¢C: ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆãªã—
â†’ ä¸€è²«æ€§ãŒãªããƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ··ä¹±
```

---

## T017: ãƒ‡ãƒ¢æ©Ÿèƒ½ã®ç’°å¢ƒåˆ†é›¢

### è¨­è¨ˆæ–¹é‡

#### 1. ç’°å¢ƒåˆ†é›¢æˆ¦ç•¥

**ç’°å¢ƒå®šç¾©**:
| ç’°å¢ƒ | ç”¨é€” | ãƒ‡ãƒ¢æ©Ÿèƒ½ | ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ |
|------|------|---------|----------|
| **production** | æœ¬ç•ªç’°å¢ƒ | âŒ éè¡¨ç¤º | âŒ æŠ•å…¥ç¦æ­¢ |
| **staging** | ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° | âš ï¸ åˆ¶é™è¡¨ç¤º | âš ï¸ ä¸€éƒ¨ã®ã¿ |
| **development** | é–‹ç™ºç’°å¢ƒ | âœ… è¡¨ç¤º | âœ… æŠ•å…¥å¯ |
| **demo** | ãƒ‡ãƒ¢å°‚ç”¨ç’°å¢ƒ | âœ… è¡¨ç¤º | âœ… å®Œå…¨æŠ•å…¥ |

#### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

**.env è¨­å®š**:
```bash
# ç’°å¢ƒè­˜åˆ¥
NODE_ENV=production  # production | staging | development | demo

# ãƒ‡ãƒ¢æ©Ÿèƒ½åˆ¶å¾¡
ENABLE_DEMO_FEATURES=false  # æœ¬ç•ªã¯false
ENABLE_DEMO_DATA=false      # æœ¬ç•ªã¯false
DEMO_MODE_BANNER=false      # ãƒ‡ãƒ¢ãƒãƒŠãƒ¼è¡¨ç¤ºåˆ¶å¾¡

# ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶å¾¡
DEMO_USER_PREFIX=demo_      # ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¥é ­è¾
DEMO_USER_EXPIRY_DAYS=7     # ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼æœ‰åŠ¹æœŸé™ï¼ˆæ—¥ï¼‰
```

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

**ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿è­˜åˆ¥ç”¨ã‚«ãƒ©ãƒ è¿½åŠ **:
```prisma
// schema.prisma - æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ
model users {
  // æ—¢å­˜ã‚«ãƒ©ãƒ ...
  isDemo         Boolean  @default(false)  // æ–°è¦è¿½åŠ 
  demoExpiryDate DateTime?                // æ–°è¦è¿½åŠ 

  @@index([isDemo])
}

model companies {
  // æ—¢å­˜ã‚«ãƒ©ãƒ ...
  isDemo         Boolean  @default(false)

  @@index([isDemo])
}

model departments {
  // æ—¢å­˜ã‚«ãƒ©ãƒ ...
  isDemo         Boolean  @default(false)

  @@index([isDemo])
}

model workflow_requests {
  // æ—¢å­˜ã‚«ãƒ©ãƒ ...
  isDemo         Boolean  @default(false)

  @@index([isDemo])
}
```

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:
```sql
-- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«isDemoè¿½åŠ 
ALTER TABLE users ADD COLUMN is_demo BOOLEAN DEFAULT FALSE;
ALTER TABLE companies ADD COLUMN is_demo BOOLEAN DEFAULT FALSE;
ALTER TABLE departments ADD COLUMN is_demo BOOLEAN DEFAULT FALSE;
ALTER TABLE workflow_requests ADD COLUMN is_demo BOOLEAN DEFAULT FALSE;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
CREATE INDEX idx_users_is_demo ON users(is_demo);
CREATE INDEX idx_companies_is_demo ON companies(is_demo);
CREATE INDEX idx_departments_is_demo ON departments(is_demo);
CREATE INDEX idx_workflow_requests_is_demo ON workflow_requests(is_demo);

-- æ—¢å­˜ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã«ãƒ•ãƒ©ã‚°è¨­å®š
UPDATE users SET is_demo = TRUE WHERE username LIKE 'demo%';
UPDATE companies SET is_demo = TRUE WHERE code LIKE 'DEMO%';
```

#### 4. ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿æŠ•å…¥åˆ¶å¾¡

**seed.ts åˆ†é›¢**:
```typescript
// prisma/seed.ts - æœ¬ç•ªç”¨ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  const env = process.env.NODE_ENV
  const enableDemo = process.env.ENABLE_DEMO_DATA === 'true'

  console.log(`ğŸŒ± Seeding database (ç’°å¢ƒ: ${env})`)

  // æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ï¼ˆå…¨ç’°å¢ƒï¼‰
  await seedProductionData()

  // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆè¨±å¯ã•ã‚ŒãŸç’°å¢ƒã®ã¿ï¼‰
  if (enableDemo && ['development', 'demo', 'staging'].includes(env)) {
    console.log('ğŸ“¦ ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¾ã™...')
    await seedDemoData()
  } else {
    console.log('âš ï¸ æœ¬ç•ªç’°å¢ƒã®ãŸã‚ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™')
  }
}

/**
 * æœ¬ç•ªç”¨ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
 */
async function seedProductionData() {
  // æ©Ÿèƒ½ãƒã‚¹ã‚¿
  await prisma.features.createMany({
    data: [
      { code: 'USER_MGMT', name: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†', color: '#1890ff' },
      { code: 'DEPT_MGMT', name: 'éƒ¨ç½²ç®¡ç†', color: '#52c41a' },
      // ...
    ]
  })

  // æ¨©é™ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰
  await createPermissionTemplates()

  console.log('âœ… æœ¬ç•ªãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº†')
}

/**
 * ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
 */
async function seedDemoData() {
  // ãƒ‡ãƒ¢ä¼šç¤¾
  const demoCompany = await prisma.companies.create({
    data: {
      code: 'DEMO001',
      name: 'ãƒ‡ãƒ¢æ ªå¼ä¼šç¤¾',
      isDemo: true  // ãƒ‡ãƒ¢ãƒ•ãƒ©ã‚°
    }
  })

  // ãƒ‡ãƒ¢éƒ¨ç½²
  const demoDept = await prisma.departments.create({
    data: {
      companyId: demoCompany.id,
      code: 'DEMO_SALES',
      name: 'ãƒ‡ãƒ¢å–¶æ¥­éƒ¨',
      isDemo: true
    }
  })

  // ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼
  const demoUsers = await prisma.users.createMany({
    data: [
      {
        username: 'demo_admin',
        email: 'demo.admin@example.com',
        password: await hashPassword('Demo1234!'),
        name: 'ãƒ‡ãƒ¢ç®¡ç†è€…',
        role: 'ADMIN',
        companyId: demoCompany.id,
        isDemo: true,
        demoExpiryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7æ—¥å¾Œ
      },
      {
        username: 'demo_user',
        email: 'demo.user@example.com',
        password: await hashPassword('Demo1234!'),
        name: 'ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼',
        role: 'USER',
        companyId: demoCompany.id,
        primaryDepartmentId: demoDept.id,
        isDemo: true,
        demoExpiryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
      }
    ]
  })

  // ãƒ‡ãƒ¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
  await createDemoWorkflows(demoCompany.id, demoDept.id)

  console.log('âœ… ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿æŠ•å…¥å®Œäº†')
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
```

#### 5. ãƒ‡ãƒ¢æ©Ÿèƒ½UIåˆ¶å¾¡

**ç’°å¢ƒåˆ¤å®šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**:
```typescript
// frontend/src/core/utils/env.ts
export const ENV = {
  NODE_ENV: import.meta.env.MODE,
  ENABLE_DEMO: import.meta.env.VITE_ENABLE_DEMO === 'true',
  DEMO_BANNER: import.meta.env.VITE_DEMO_BANNER === 'true'
}

export const isDevelopment = () => ENV.NODE_ENV === 'development'
export const isProduction = () => ENV.NODE_ENV === 'production'
export const isDemo = () => ENV.NODE_ENV === 'demo'
export const isDemoEnabled = () => ENV.ENABLE_DEMO
```

**ãƒ‡ãƒ¢ãƒãƒŠãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
```vue
<!-- frontend/src/core/components/DemoBanner.vue -->
<template>
  <el-alert
    v-if="showBanner"
    type="warning"
    :closable="false"
    show-icon
    class="demo-banner"
  >
    <template #title>
      <el-icon><WarningFilled /></el-icon>
      ãƒ‡ãƒ¢ç’°å¢ƒ
    </template>
    <div>
      ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ‡ãƒ¢ç’°å¢ƒã§ã™ã€‚å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯å®šæœŸçš„ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚
    </div>
  </el-alert>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { WarningFilled } from '@element-plus/icons-vue'
import { isDemoEnabled } from '@core/utils/env'

const showBanner = computed(() => isDemoEnabled())
</script>

<style scoped>
.demo-banner {
  position: fixed;
  top: 60px;
  left: 0;
  right: 0;
  z-index: 1000;
  border-radius: 0;
}
</style>
```

**ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**:
```typescript
// backend/src/core/middleware/demoFilter.ts
import { Request, Response, NextFunction } from 'express'

/**
 * ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿é™¤å¤–ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰
 */
export const excludeDemoData = (req: Request, res: Response, next: NextFunction) => {
  const isProduction = process.env.NODE_ENV === 'production'

  if (isProduction) {
    // Prismaã‚¯ã‚¨ãƒªã«ãƒ‡ãƒ¢é™¤å¤–æ¡ä»¶ã‚’è‡ªå‹•è¿½åŠ 
    const originalJson = res.json.bind(res)
    res.json = function (data: any) {
      if (data && data.data && Array.isArray(data.data)) {
        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’é™¤å¤–
        data.data = data.data.filter((item: any) => !item.isDemo)
      }
      return originalJson(data)
    }
  }

  next()
}

/**
 * Prismaã‚¯ã‚¨ãƒªæ‹¡å¼µï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿è‡ªå‹•é™¤å¤–ï¼‰
 */
export const getDemoFilter = () => {
  const isProduction = process.env.NODE_ENV === 'production'
  return isProduction ? { isDemo: false } : {}
}

// ä½¿ç”¨ä¾‹
router.get('/users', async (req, res) => {
  const users = await prisma.users.findMany({
    where: {
      ...getDemoFilter(),  // æœ¬ç•ªç’°å¢ƒã§ã¯è‡ªå‹•çš„ã« isDemo: false ãŒè¿½åŠ ã•ã‚Œã‚‹
      isActive: true
    }
  })
  res.json({ success: true, data: users })
})
```

#### 6. ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
```typescript
// scripts/cleanupDemoData.ts
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function cleanupExpiredDemoData() {
  console.log('ğŸ§¹ æœŸé™åˆ‡ã‚Œãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™...')

  const now = new Date()

  // æœŸé™åˆ‡ã‚Œãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
  const expiredUsers = await prisma.users.deleteMany({
    where: {
      isDemo: true,
      demoExpiryDate: {
        lt: now
      }
    }
  })

  console.log(`âœ… ${expiredUsers.count}ä»¶ã®ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`)

  // ãƒ‡ãƒ¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šå‰ï¼‰
  const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)
  const expiredWorkflows = await prisma.workflow_requests.deleteMany({
    where: {
      isDemo: true,
      createdAt: {
        lt: thirtyDaysAgo
      }
    }
  })

  console.log(`âœ… ${expiredWorkflows.count}ä»¶ã®ãƒ‡ãƒ¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`)

  console.log('ğŸ‰ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†')
}

cleanupExpiredDemoData()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
```

**Cronã‚¸ãƒ§ãƒ–è¨­å®š**:
```bash
# crontabè¨­å®šä¾‹ï¼ˆæ¯æ—¥åˆå‰3æ™‚ã«å®Ÿè¡Œï¼‰
0 3 * * * cd /path/to/websys && npm run cleanup:demo
```

---

## T018: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆçµ±ä¸€

### è¨­è¨ˆæ–¹é‡

#### 1. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³éšå±¤æ§‹é€ 

**3éšå±¤ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä½“ç³»**:
```
Level 1: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
â”œâ”€ Level 2: ã‚µãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
   â””â”€ Level 3: ãƒšãƒ¼ã‚¸å†…ã‚¿ãƒ–ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
```

**å…·ä½“ä¾‹**:
```
ğŸ  ãƒ›ãƒ¼ãƒ 
ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
   â”œâ”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
   â”œâ”€ éƒ¨ç½²ç®¡ç†
   â””â”€ æ¨©é™è¨­å®š
ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
   â”œâ”€ ç”³è«‹ä¸€è¦§
   â”œâ”€ æ‰¿èªå¾…ã¡
   â””â”€ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š
ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆ
   â”œâ”€ çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆ
   â””â”€ ç›£æŸ»ãƒ­ã‚°
âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼ˆADMIN ã®ã¿ï¼‰
   â”œâ”€ å…¨ä½“è¨­å®š
   â””â”€ ãƒ­ã‚°ç›£è¦–
```

#### 2. ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆçµ±ä¸€

**ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆå®Ÿè£…**:
```vue
<!-- frontend/src/core/components/Breadcrumb.vue -->
<template>
  <el-breadcrumb separator="/" class="mb-4">
    <el-breadcrumb-item :to="{ path: '/' }">
      <el-icon><HomeFilled /></el-icon>
      ãƒ›ãƒ¼ãƒ 
    </el-breadcrumb-item>
    <el-breadcrumb-item
      v-for="(item, index) in breadcrumbs"
      :key="index"
      :to="item.to"
    >
      {{ item.label }}
    </el-breadcrumb-item>
  </el-breadcrumb>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useRoute } from 'vue-router'
import { HomeFilled } from '@element-plus/icons-vue'

const route = useRoute()

const breadcrumbs = computed(() => {
  const matched = route.matched.filter(r => r.meta && r.meta.breadcrumb)
  return matched.map(r => ({
    label: r.meta.breadcrumb,
    to: r.path
  }))
})
</script>
```

**ãƒ«ãƒ¼ãƒˆè¨­å®šï¼ˆbreadcrumbè¿½åŠ ï¼‰**:
```typescript
// frontend/src/router/index.ts
const routes = [
  {
    path: '/users',
    name: 'Users',
    component: () => import('@/views/Users.vue'),
    meta: {
      breadcrumb: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†',
      requiresAuth: true
    },
    children: [
      {
        path: 'list',
        name: 'UserList',
        component: () => import('@/views/UserList.vue'),
        meta: {
          breadcrumb: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§'
        }
      },
      {
        path: ':id/edit',
        name: 'UserEdit',
        component: () => import('@/views/UserEdit.vue'),
        meta: {
          breadcrumb: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†'
        }
      }
    ]
  }
]
```

#### 3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒ«ãƒ‘ãƒ¼

**çµ±ä¸€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°**:
```typescript
// frontend/src/core/composables/useNavigation.ts
import { useRouter, useRoute } from 'vue-router'
import { ElMessage } from 'element-plus'

export function useNavigation() {
  const router = useRouter()
  const route = useRoute()

  /**
   * æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆçµ±ä¸€å®Ÿè£…ï¼‰
   */
  const goBack = (fallbackPath = '/') => {
    if (window.history.length > 1) {
      router.back()
    } else {
      router.push(fallbackPath)
    }
  }

  /**
   * è©³ç´°ç”»é¢ã¸é·ç§»
   */
  const goToDetail = (id: number, detailPath: string) => {
    router.push({ path: `${detailPath}/${id}` })
  }

  /**
   * ç·¨é›†ç”»é¢ã¸é·ç§»
   */
  const goToEdit = (id: number, editPath: string) => {
    router.push({ path: `${editPath}/${id}/edit` })
  }

  /**
   * ä¿å­˜å¾Œã®é·ç§»ï¼ˆçµ±ä¸€ï¼‰
   */
  const afterSave = (message: string, redirectPath?: string) => {
    ElMessage.success(message)
    if (redirectPath) {
      router.push(redirectPath)
    } else {
      goBack()
    }
  }

  /**
   * å‰Šé™¤å¾Œã®é·ç§»ï¼ˆçµ±ä¸€ï¼‰
   */
  const afterDelete = (message: string, redirectPath: string) => {
    ElMessage.success(message)
    router.push(redirectPath)
  }

  /**
   * ç¾åœ¨ã®ãƒ‘ã‚¹å–å¾—
   */
  const currentPath = () => route.path

  /**
   * ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆç”¨ãƒ‘ã‚¹å–å¾—
   */
  const getBreadcrumbPath = () => {
    return route.matched
      .filter(r => r.meta && r.meta.breadcrumb)
      .map(r => ({
        path: r.path,
        label: r.meta.breadcrumb as string
      }))
  }

  return {
    goBack,
    goToDetail,
    goToEdit,
    afterSave,
    afterDelete,
    currentPath,
    getBreadcrumbPath
  }
}
```

**ä½¿ç”¨ä¾‹**:
```vue
<script setup lang="ts">
import { useNavigation } from '@core/composables/useNavigation'

const { goBack, afterSave } = useNavigation()

const handleSave = async () => {
  await saveUser(form.value)
  afterSave('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ', '/users/list')
}

const handleCancel = () => {
  goBack('/users/list')  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æŒ‡å®š
}
</script>
```

#### 4. ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ§‹é€ å®šç¾©

**ãƒ¡ãƒ‹ãƒ¥ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«**:
```typescript
// frontend/src/core/config/menu.ts
export interface MenuItem {
  id: string
  label: string
  icon: string
  path?: string
  children?: MenuItem[]
  permission?: string
  roles?: string[]
}

export const MENU_STRUCTURE: MenuItem[] = [
  {
    id: 'home',
    label: 'ãƒ›ãƒ¼ãƒ ',
    icon: 'HomeFilled',
    path: '/'
  },
  {
    id: 'dashboard',
    label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
    icon: 'DataAnalysis',
    path: '/dashboard'
  },
  {
    id: 'users',
    label: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†',
    icon: 'User',
    permission: 'USER_MGMT',
    children: [
      {
        id: 'user-list',
        label: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§',
        icon: 'List',
        path: '/users/list'
      },
      {
        id: 'department',
        label: 'éƒ¨ç½²ç®¡ç†',
        icon: 'OfficeBuilding',
        path: '/departments',
        permission: 'DEPT_MGMT'
      },
      {
        id: 'permissions',
        label: 'æ¨©é™è¨­å®š',
        icon: 'Lock',
        path: '/permissions',
        roles: ['ADMIN', 'MANAGER']
      }
    ]
  },
  {
    id: 'workflow',
    label: 'ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼',
    icon: 'DocumentCopy',
    permission: 'WORKFLOW',
    children: [
      {
        id: 'workflow-requests',
        label: 'ç”³è«‹ä¸€è¦§',
        icon: 'List',
        path: '/workflow/requests'
      },
      {
        id: 'workflow-pending',
        label: 'æ‰¿èªå¾…ã¡',
        icon: 'Clock',
        path: '/workflow/pending'
      },
      {
        id: 'workflow-settings',
        label: 'ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š',
        icon: 'Setting',
        path: '/workflow/settings',
        roles: ['ADMIN', 'MANAGER']
      }
    ]
  },
  {
    id: 'reports',
    label: 'ãƒ¬ãƒãƒ¼ãƒˆ',
    icon: 'DataLine',
    permission: 'REPORT',
    children: [
      {
        id: 'statistics',
        label: 'çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆ',
        icon: 'TrendCharts',
        path: '/reports/statistics'
      },
      {
        id: 'audit',
        label: 'ç›£æŸ»ãƒ­ã‚°',
        icon: 'Document',
        path: '/reports/audit',
        roles: ['ADMIN']
      }
    ]
  },
  {
    id: 'system',
    label: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®š',
    icon: 'Setting',
    roles: ['ADMIN'],
    children: [
      {
        id: 'system-settings',
        label: 'å…¨ä½“è¨­å®š',
        icon: 'Tools',
        path: '/system/settings'
      },
      {
        id: 'log-monitoring',
        label: 'ãƒ­ã‚°ç›£è¦–',
        icon: 'Monitor',
        path: '/system/logs'
      }
    ]
  }
]
```

**ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”Ÿæˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
```vue
<!-- frontend/src/core/components/Navigation.vue -->
<template>
  <el-menu
    :default-active="activeMenu"
    mode="horizontal"
    :ellipsis="false"
    router
  >
    <template v-for="item in filteredMenu" :key="item.id">
      <!-- å­ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãªã— -->
      <el-menu-item v-if="!item.children" :index="item.path">
        <el-icon><component :is="item.icon" /></el-icon>
        <span>{{ item.label }}</span>
      </el-menu-item>

      <!-- å­ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Š -->
      <el-sub-menu v-else :index="item.id">
        <template #title>
          <el-icon><component :is="item.icon" /></el-icon>
          <span>{{ item.label }}</span>
        </template>
        <el-menu-item
          v-for="child in item.children"
          :key="child.id"
          :index="child.path"
        >
          <el-icon><component :is="child.icon" /></el-icon>
          <span>{{ child.label }}</span>
        </el-menu-item>
      </el-sub-menu>
    </template>
  </el-menu>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useRoute } from 'vue-router'
import { useAuthStore } from '@custom/stores/auth'
import { MENU_STRUCTURE } from '@core/config/menu'

const route = useRoute()
const authStore = useAuthStore()

const activeMenu = computed(() => route.path)

/**
 * æ¨©é™ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
 */
const filteredMenu = computed(() => {
  return MENU_STRUCTURE.filter(item => {
    // å½¹è·ãƒã‚§ãƒƒã‚¯
    if (item.roles && !item.roles.includes(authStore.user?.role)) {
      return false
    }

    // æ¨©é™ãƒã‚§ãƒƒã‚¯
    if (item.permission && !authStore.hasPermission(item.permission)) {
      return false
    }

    // å­ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    if (item.children) {
      item.children = item.children.filter(child => {
        if (child.roles && !child.roles.includes(authStore.user?.role)) {
          return false
        }
        if (child.permission && !authStore.hasPermission(child.permission)) {
          return false
        }
        return true
      })

      // å­ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå…¨ã¦éè¡¨ç¤ºãªã‚‰è¦ªã‚‚éè¡¨ç¤º
      if (item.children.length === 0) {
        return false
      }
    }

    return true
  })
})
</script>
```

#### 5. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

**ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå®Ÿè£…**:
```typescript
// frontend/src/core/composables/useShortcuts.ts
import { onMounted, onUnmounted } from 'vue'
import { useRouter } from 'vue-router'

export function useShortcuts() {
  const router = useRouter()

  const shortcuts = {
    // Ctrl+K: æ¤œç´¢
    'ctrl+k': () => {
      // æ¤œç´¢ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
      console.log('æ¤œç´¢ã‚’é–‹ã')
    },
    // Ctrl+H: ãƒ›ãƒ¼ãƒ 
    'ctrl+h': () => {
      router.push('/')
    },
    // Ctrl+,: è¨­å®š
    'ctrl+,': () => {
      router.push('/settings')
    },
    // Esc: ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
    'esc': () => {
      // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹å‡¦ç†
    }
  }

  const handleKeyDown = (event: KeyboardEvent) => {
    const key = []
    if (event.ctrlKey) key.push('ctrl')
    if (event.altKey) key.push('alt')
    if (event.shiftKey) key.push('shift')
    key.push(event.key.toLowerCase())

    const shortcut = key.join('+')
    if (shortcuts[shortcut]) {
      event.preventDefault()
      shortcuts[shortcut]()
    }
  }

  onMounted(() => {
    window.addEventListener('keydown', handleKeyDown)
  })

  onUnmounted(() => {
    window.removeEventListener('keydown', handleKeyDown)
  })

  return { shortcuts }
}
```

---

## UI/UXã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 1. ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡

| åŸå‰‡ | å†…å®¹ |
|------|------|
| **ä¸€è²«æ€§** | åŒã˜æ“ä½œã¯åŒã˜å ´æ‰€ãƒ»åŒã˜æ–¹æ³•ã§ |
| **äºˆæ¸¬å¯èƒ½æ€§** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœŸå¾…é€šã‚Šã«å‹•ä½œ |
| **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯** | æ“ä½œçµæœã‚’æ˜ç¢ºã«è¡¨ç¤º |
| **åŠ¹ç‡æ€§** | æœ€å°ã‚¯ãƒªãƒƒã‚¯æ•°ã§ç›®çš„é”æˆ |

### 2. ãƒœã‚¿ãƒ³é…ç½®çµ±ä¸€

**æ¨™æº–ãƒœã‚¿ãƒ³é…ç½®**:
```vue
<!-- ç·¨é›†ç”»é¢ã®æ¨™æº–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
<template>
  <div class="page-container">
    <Breadcrumb />
    <el-card>
      <template #header>
        <div class="card-header">
          <h2>{{ title }}</h2>
        </div>
      </template>

      <el-form>
        <!-- ãƒ•ã‚©ãƒ¼ãƒ å†…å®¹ -->
      </el-form>

      <!-- ãƒ•ãƒƒã‚¿ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆå³å¯„ã›ãƒ»æ¨™æº–é †åºï¼‰ -->
      <div class="footer-actions">
        <el-button @click="handleCancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</el-button>
        <el-button type="primary" @click="handleSave">ä¿å­˜</el-button>
      </div>
    </el-card>
  </div>
</template>

<style scoped>
.footer-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid #e8e8e8;
}
</style>
```

### 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºçµ±ä¸€

**æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¨™æº–**:
```typescript
// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
ElMessage.success('ä¿å­˜ã—ã¾ã—ãŸ')

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
ElMessage.error('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ')

// è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
ElMessage.warning('æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™')

// æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
ElMessage.info('å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã—ãŸ')
```

---

## å®Ÿè£…è¨ˆç”»

### Phase 3-5: T017å®Ÿè£…ï¼ˆ1é€±é–“ï¼‰
- [ ] ç’°å¢ƒå¤‰æ•°è¨­å®š
- [ ] isDemo ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- [ ] seed.ts åˆ†é›¢å®Ÿè£…
- [ ] ãƒ‡ãƒ¢ãƒãƒŠãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å®Ÿè£…
- [ ] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…
- [ ] å‹•ä½œç¢ºèª

### Phase 3-6: T018å®Ÿè£…ï¼ˆ1é€±é–“ï¼‰
- [ ] ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] useNavigation composableå®Ÿè£…
- [ ] ãƒ¡ãƒ‹ãƒ¥ãƒ¼å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [ ] ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå®Ÿè£…
- [ ] å…¨ç”»é¢ã¸ã®ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆé©ç”¨
- [ ] å‹•ä½œç¢ºèª

**ç·æ‰€è¦æœŸé–“**: 2é€±é–“

---

## ä»˜éŒ²

### é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [æ”¹å–„å®Ÿè£…ã‚¿ã‚¹ã‚¯ç®¡ç†è¡¨](../../legacy/numbered-docs/51-æ”¹å–„å®Ÿè£…ã‚¿ã‚¹ã‚¯ç®¡ç†è¡¨.md)
- [Phase 2å®Œäº†ç·åˆå ±å‘Š](../../08_å ±å‘Š/46_Phase2å®Œäº†ç·åˆå ±å‘Š.md)

---

**ä½œæˆæ—¥**: 2025-10-05
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æ‰¿èªçŠ¶æ…‹**: è¨­è¨ˆä¸­
