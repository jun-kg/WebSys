# 実装チェックリストと検証手順

## 概要

環境チェック結果に基づく修正作業の品質確保と進捗管理のため、詳細なチェックリストと検証手順を定義します。

## 🔴 Phase 1: 緊急修正チェックリスト

### 1.1 UDゴシックフォント適用

#### 作業前チェック
- [ ] 現在のフォント設定を確認済み
- [ ] ブラウザの開発者ツールでフォント確認方法を理解済み
- [ ] バックアップ取得済み

#### 実装チェック
- [ ] `workspace/frontend/src/App.vue`を修正
- [ ] UDゴシック優先のフォントスタックを設定
- [ ] 既存のスタイルを上書きしない設定

#### 検証手順
```bash
# 1. ブラウザでの確認
cd workspace/frontend
npm run dev

# 2. 開発者ツールでフォント確認
# Elements > Computed > font-family で確認

# 3. 複数ブラウザでの確認
# Chrome, Firefox, Safari で表示確認
```

#### 合格基準
- [ ] ブラウザで「BIZ UDPGothic」または類似フォントが適用されている
- [ ] 文字が読みやすく表示されている
- [ ] レイアウト崩れが発生していない
- [ ] モバイルブラウザでも正常表示

### 1.2 共通コンポーネントライブラリ最小実装

#### 作業前チェック
- [ ] packages ディレクトリの構造を理解済み
- [ ] Element Plus の使用方法を理解済み
- [ ] TypeScript の型定義を理解済み

#### ディレクトリ作成チェック
```bash
# ディレクトリ構造確認
tree packages/shared-components
```

期待される構造:
```
packages/shared-components/
├── package.json
├── src/
│   ├── components/
│   │   └── CommonButton/
│   │       └── index.vue
│   ├── composables/
│   │   └── useResponsive.ts
│   └── index.ts
└── dist/
```

- [ ] 正しいディレクトリ構造が作成されている
- [ ] package.json が適切に設定されている
- [ ] TypeScript設定が適切

#### CommonButton実装チェック
- [ ] Props の型定義が正しい
- [ ] responsive プロパティが動作する
- [ ] touchOptimized で最小44pxが確保される
- [ ] fullWidthMobile でモバイル全幅表示される
- [ ] UDゴシックフォントが継承される

#### 検証手順
```bash
# 1. ビルド確認
cd packages/shared-components
npm run build

# 2. 型チェック
npm run type-check

# 3. 動作テスト
cd ../../workspace/frontend
npm install
npm run dev
```

#### 合格基準
- [ ] ビルドエラーなし
- [ ] TypeScriptエラーなし
- [ ] CommonButtonが画面に表示される
- [ ] レスポンシブ動作が正常
- [ ] タッチ対応サイズが適用される

### 1.3 Dashboard.vue サンプル修正

#### 作業前チェック
- [ ] 現在のDashboard.vueの構造を把握済み
- [ ] 修正対象のel-buttonを特定済み
- [ ] CommonButtonのAPIを理解済み

#### 実装チェック
- [ ] CommonButtonをインポート
- [ ] 最低1つのel-buttonをCommonButtonに置換
- [ ] イベントハンドラの書き換え（@click → @on-click）
- [ ] propsの書き換え（type → variant）

#### 検証手順
```bash
# 1. 構文チェック
cd workspace/frontend
npm run type-check

# 2. 動作確認
npm run dev
# ブラウザでDashboardページを表示

# 3. 機能テスト
# 修正したボタンをクリックして正常動作を確認
```

#### 合格基準
- [ ] ビルドエラーなし
- [ ] 置換したボタンが正常表示
- [ ] ボタンクリックで元の機能が動作
- [ ] スタイルが適切に適用
- [ ] レスポンシブ表示が正常

### Phase 1 総合検証

#### 統合テスト手順
```bash
# 1. 全体ビルド
npm run build

# 2. 型チェック
npm run type-check

# 3. リント
npm run lint

# 4. E2Eテスト（基本機能）
npm run test:e2e

# 5. アクセシビリティ基本チェック
npm run accessibility-check
```

#### Phase 1 完了条件
- [ ] すべての個別チェックがPASS
- [ ] 統合テストがPASS
- [ ] Element Plus直接使用が1箇所以上削減
- [ ] UDゴシックフォントが全体適用
- [ ] 修正手順が文書化済み

## 🟡 Phase 2: 重要修正チェックリスト

### 2.1 共通コンポーネント完全実装

#### CommonCard実装チェック
- [ ] Props型定義が正しい
- [ ] スロット（header, footer）が動作
- [ ] レスポンシブ対応が適切
- [ ] モバイルでのマージン調整

#### CommonTable実装チェック
- [ ] column定義の型が正しい
- [ ] mobileLayout プロパティが動作
- [ ] カード表示への切り替えが正常
- [ ] ページネーションが適切

#### CommonTag実装チェック
- [ ] バリアント（type）が正しく適用
- [ ] サイズ調整が適切
- [ ] 閉じるボタンの動作

#### CommonRow/Col実装チェック
- [ ] レスポンシブグリッドが正常
- [ ] ガッター設定が適切
- [ ] ブレークポイント対応

#### 検証手順
```bash
# 各コンポーネントの単体テスト
cd packages/shared-components
npm run test

# ビルド確認
npm run build

# 型チェック
npm run type-check

# Storybook確認（実装済みの場合）
npm run storybook
```

### 2.2 ファイル別置換チェック

#### Dashboard.vue 完全置換
置換対象コンポーネント:
- [ ] el-row → CommonRow（2箇所）
- [ ] el-col → CommonCol（8箇所）
- [ ] el-card → CommonCard（6箇所）
- [ ] el-button → CommonButton（4箇所）
- [ ] el-table → CommonTable（1箇所）
- [ ] el-tag → CommonTag（4箇所）
- [ ] el-progress → CommonProgress（2箇所）

#### Users.vue 置換チェック
- [ ] el-table 系コンポーネント置換
- [ ] el-button 置換
- [ ] el-input 置換
- [ ] el-select 置換

#### Login.vue 置換チェック
- [ ] el-form 置換
- [ ] el-form-item 置換
- [ ] el-input 置換
- [ ] el-button 置換

#### Layout.vue 置換チェック
- [ ] el-container 置換
- [ ] el-header 置換
- [ ] el-aside 置換
- [ ] el-menu 置換

#### 置換検証手順
```bash
# Element Plus使用箇所確認
grep -r "el-" workspace/frontend/src/views/

# 期待値: 0件

# 動作確認
cd workspace/frontend
npm run dev

# 各ページの動作テスト
# 1. Dashboard - 統計表示、テーブル表示、ボタン動作
# 2. Users - ユーザー一覧、検索、操作
# 3. Login - ログイン処理
# 4. Layout - ナビゲーション、レスポンシブ
```

### 2.3 依存関係整理チェック

#### package.json修正確認
```bash
# フロントエンドの依存関係確認
cat workspace/frontend/package.json

# 確認項目
# - element-plus が削除されている
# - @company/shared-components が追加されている
# - @company/shared-theme が追加されている
```

#### 期待される依存関係
```json
{
  "dependencies": {
    "@company/shared-components": "workspace:*",
    "@company/shared-theme": "workspace:*",
    "@element-plus/icons-vue": "^2.3.1",
    "vue": "^3.4.15",
    "vue-router": "^4.2.5",
    "pinia": "^2.1.7",
    "axios": "^1.6.5"
  }
}
```

#### 検証手順
```bash
# 依存関係インストール
cd workspace/frontend
npm install

# ビルド確認
npm run build

# 起動確認
npm run dev
```

### Phase 2 総合検証

#### Element Plus使用量測定
```bash
# 自動チェックスクリプト作成
cat > tools/check-element-usage.sh << 'EOF'
#!/bin/bash
echo "=== Element Plus 直接使用チェック ==="
echo "対象ディレクトリ: workspace/frontend/src"
echo ""

VIOLATIONS=$(grep -r "el-" workspace/frontend/src/ --include="*.vue" | wc -l)
echo "違反件数: $VIOLATIONS"

if [ $VIOLATIONS -eq 0 ]; then
    echo "✅ Element Plus直接使用なし"
    exit 0
else
    echo "❌ Element Plus直接使用あり"
    echo ""
    echo "違反箇所:"
    grep -r "el-" workspace/frontend/src/ --include="*.vue"
    exit 1
fi
EOF

chmod +x tools/check-element-usage.sh
./tools/check-element-usage.sh
```

#### Phase 2 完了条件
- [ ] Element Plus直接使用が0件
- [ ] 全ページが正常動作
- [ ] レスポンシブ表示が適切
- [ ] モバイルでの操作性が良好
- [ ] 自動チェックがすべてPASS

## 🟢 Phase 3: 改善実装チェックリスト

### 3.1 自動チェック機能

#### ESLintルール設定チェック
```bash
# ESLint設定確認
cat .eslintrc.js

# ルール動作確認
cd workspace/frontend
npx eslint src/ --fix

# 期待値: Element Plus使用箇所でエラー
```

#### カスタムルール実装チェック
- [ ] require-common-components ルールが実装済み
- [ ] JSX/template内のel-*要素を検出
- [ ] 適切なエラーメッセージを表示

### 3.2 共通テーマライブラリ適用

#### main.ts修正チェック
```bash
# main.tsの内容確認
cat workspace/frontend/src/main.ts

# 期待される内容:
# - @company/shared-theme のインポート
# - SharedComponents の使用
# - Element Plus直接インポートの削除
```

#### テーマ適用確認
```bash
# ブラウザでテーマ確認
npm run dev

# 開発者ツールでCSS変数確認
# --font-family-primary
# --font-size-accessible-min
# --color-primary
```

### 3.3 CI/CD強化

#### pre-commitフック動作確認
```bash
# フック設定確認
cat .husky/pre-commit

# フック動作テスト
git add .
git commit -m "test commit"

# 期待される動作:
# 1. font-check実行
# 2. component-check:strict実行
# 3. type-check実行
# 4. lint実行
# 5. accessibility-check実行
```

#### GitHub Actions動作確認
```bash
# workflow設定確認
cat .github/workflows/quality-gate.yml

# ローカルでの確認
npm run component-check:strict
npm run font-check
npm run accessibility-check
npm run build
```

## 包括的検証手順

### 最終統合テスト

#### 1. 機能テスト
```bash
# 全機能の動作確認スクリプト
cat > tools/functional-test.sh << 'EOF'
#!/bin/bash
echo "=== 機能テスト実行 ==="

echo "1. ビルドテスト"
npm run build || exit 1

echo "2. 型チェック"
npm run type-check || exit 1

echo "3. リント"
npm run lint || exit 1

echo "4. Element Plus使用チェック"
./tools/check-element-usage.sh || exit 1

echo "5. フォントチェック"
npm run font-check || exit 1

echo "6. アクセシビリティチェック"
npm run accessibility-check || exit 1

echo "✅ すべてのテストがPASS"
EOF

chmod +x tools/functional-test.sh
./tools/functional-test.sh
```

#### 2. ブラウザテスト
- [ ] Chrome: 正常表示・動作
- [ ] Firefox: 正常表示・動作
- [ ] Safari: 正常表示・動作
- [ ] Edge: 正常表示・動作
- [ ] Mobile Chrome: レスポンシブ表示
- [ ] Mobile Safari: レスポンシブ表示

#### 3. アクセシビリティテスト
```bash
# アクセシビリティチェックツール
npm install -g @axe-core/cli

# 各ページのテスト
axe http://localhost:3000/ --tags wcag2a,wcag2aa
axe http://localhost:3000/dashboard --tags wcag2a,wcag2aa
axe http://localhost:3000/users --tags wcag2a,wcag2aa
axe http://localhost:3000/login --tags wcag2a,wcag2aa
```

#### 4. パフォーマンステスト
```bash
# Lighthouse CLI
npm install -g lighthouse

# パフォーマンス測定
lighthouse http://localhost:3000/ --output=json --output-path=./performance-report.json

# 期待値:
# Performance: 90+
# Accessibility: 90+
# Best Practices: 90+
# SEO: 90+
```

### 品質メトリクス

#### コード品質指標
- [ ] Element Plus直接使用: 0件
- [ ] ESLintエラー: 0件
- [ ] TypeScriptエラー: 0件
- [ ] テストカバレッジ: 80%以上

#### アクセシビリティ指標
- [ ] WCAG 2.1 AA準拠
- [ ] コントラスト比4.5:1以上
- [ ] フォントサイズ16px以上
- [ ] キーボード操作対応

#### パフォーマンス指標
- [ ] Lighthouse Performance: 90+
- [ ] 初回表示: 3秒以内
- [ ] レスポンス時間: 2秒以内
- [ ] Bundle サイズ: 適切

## トラブルシューティング

### よくある問題と対処法

#### 1. ビルドエラー
```bash
# 依存関係の再インストール
rm -rf node_modules
rm package-lock.json
npm install

# 型定義の再生成
npm run type-check
```

#### 2. スタイル適用されない
```bash
# CSS優先順位の確認
# 開発者ツールでスタイル競合をチェック

# 共通テーマの再ビルド
cd packages/shared-theme
npm run build
```

#### 3. コンポーネントが表示されない
```bash
# インポートパスの確認
# デフォルトエクスポートの確認
# 名前付きエクスポートの確認
```

### エスカレーション基準

#### 即座エスカレーション
- ビルドが完全に失敗
- 重要な機能が動作しない
- セキュリティ問題の発見

#### 1時間以内にエスカレーション
- 予期しないスタイル問題
- パフォーマンス大幅低下
- アクセシビリティ基準違反

## 完了報告書テンプレート

### Phase完了時の報告内容

```markdown
# Phase [X] 完了報告

## 実施期間
開始: YYYY-MM-DD
完了: YYYY-MM-DD

## 成果物
- [ ] 修正ファイル数: X件
- [ ] 実装コンポーネント数: X個
- [ ] Element Plus削減数: X箇所

## 品質指標
- [ ] ビルドエラー: 0件
- [ ] TypeScriptエラー: 0件
- [ ] ESLintエラー: 0件
- [ ] テスト成功率: 100%

## 課題・リスク
- 発見された課題とその対処法
- 次フェーズへの引き継ぎ事項

## 次フェーズへの推奨事項
- 優先対応項目
- 注意事項
```

## まとめ

このチェックリストと検証手順により、**高品質で一貫した修正作業**が実現できます。

**重要なポイント**:
1. 段階的チェックによる品質確保
2. 自動化による継続的な品質監視
3. 明確な合格基準による客観的評価

**期待される効果**:
- 修正作業の品質向上
- 作業効率の改善
- 再発防止の確実な実現